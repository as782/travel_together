import{O as ee,d as q,b as a,ac as oe,ab as te,a1 as se,G as ne,r as p,A as ae,H as re,s as x,v as ie,J as V,c as L,w as v,a as r,E as I,u as c,D as le,C as ce,aA as ue,f as de,o as y,B as T,g as D,I as me,M as fe,F as _e}from"./index-Al1ESLyH.js";import{S as pe}from"./index-D0XsUnBT.js";import{a as ve,A as he}from"./index-ByBQl65H.js";import{_ as ge}from"./CommentPlane.vue_vue_type_script_setup_true_lang-wUZzw904.js";import{T as we}from"./TopNav-B1tNCFOC.js";import{S as ke}from"./index-BKOHJvEI.js";import{k as xe,l as ye}from"./index-Bc0MyXRq.js";import{l as E}from"./lodash-TVC-EY0t.js";import{g as Ce}from"./tool-DO7ubHTV.js";import{A as Ie}from"./index-DEValKwa.js";import{s as Se}from"./function-call-CNCgHTtt.js";import{I as be}from"./index-o3mCI9mj.js";import{B as Be}from"./index-dW7UAVpM.js";import"./index-DVp0JOWu.js";import"./use-tab-status-CfkwxFsA.js";import"./index-uvLI7Ok2.js";const[Pe,Te]=ee("divider"),De={dashed:Boolean,hairline:oe,vertical:Boolean,contentPosition:te("center")};var Ue=q({name:Pe,props:De,setup(_,{slots:k}){return()=>{var h;return a("div",{role:"separator",class:Te({dashed:_.dashed,hairline:_.hairline,vertical:_.vertical,[`content-${_.contentPosition}`]:!!k.default&&!_.vertical})},[!_.vertical&&((h=k.default)==null?void 0:h.call(k))])}}});const Fe=se(Ue),Me={class:"flex items-center w-full"},Oe={class:"flex flex-col flex-1 ml-2"},$e={class:"text-sm text-left"},Ae={class:"user-state text-xs text-left text-gray-500"},Ne={class:"p-2"},Ve={class:"moment-content"},Le={class:"content-text"},Ee={class:"content-resource my-2 columns-2 flex-wrap"},qe={class:"moment-comment"},ao=q({__name:"MomentDetailPage",setup(_){const k=ue(),h=de(),S=Number(k.params.id),d=ne(),g=p(),z=ae(()=>d.myFollows.data.some(t=>{var e;return t.user_id===((e=g.value)==null?void 0:e.user_id)})),U=p(z),H=E.debounce(async()=>{var o;const t=d.userInfo,e={follower_id:t==null?void 0:t.user_id,following_id:(o=g.value)==null?void 0:o.user_id,action:1};try{await re(e),d.getMyFollows(),U.value=!0}catch{x("操作失败")}},200),R=()=>{var o,n,i;const t=(o=g.value)==null?void 0:o.user_id,e=(n=d.userInfo)==null?void 0:n.user_id;if(t===e)return h.push("/mine");h.push(`/user/${(i=g.value)==null?void 0:i.user_id}`)};ie(()=>{J(S)});let u=p();const G=t=>{var e;Se({images:((e=u.value)==null?void 0:e.images.map(o=>o.image_url))||[],startPosition:t})},J=async t=>{var e,o;try{let n=await xe(t);u.value=n.data,g.value=n.data.user_info,B.value=(e=n.data.like_userIds)==null?void 0:e.length,P.value=(o=n.data.like_userIds)==null?void 0:o.some(i=>{var f;return i===((f=d.userInfo)==null?void 0:f.user_id)})}catch(n){console.error(n)}},m=V({loading:!1,finished:!1,error:!1}),b=p([]),j=()=>{setTimeout(()=>{var t,e;b.value=((e=(t=u.value)==null?void 0:t.comments)==null?void 0:e.map(o=>({comment_id:o.comment_id,content:o.content,createTime:o.created_at,userInfo:o.user_info})).reverse())||[],m.loading=!1,m.finished=!0},100)},w=p(),K=async()=>{var t;if(!w.value){x("大哥，说点啥再评论吧！");return}try{const e=w.value,n={user_id:(t=d.userInfo)==null?void 0:t.user_id,post_id:S,content:e},i=await ve(n);x(i.msg);const f=new Date;b.value.unshift({comment_id:f.getTime(),content:w.value,createTime:f.toISOString(),userInfo:d.userInfo}),w.value=""}catch(e){console.error(e)}},B=p(),P=p(),Q=E.debounce(async()=>{var e;const t={post_id:S,user_id:(e=d.userInfo)==null?void 0:e.user_id};try{const o=await ye(t);B.value+=o.data,P.value=o.data>0,x(o.msg)}catch{x("操作失败")}},200),C=V({isShow:!1,shareOptions:ke});return(t,e)=>{var M,O;const o=me,n=be,i=Be,f=fe,W=Fe,X=_e,F=he,Y=Ie,Z=pe;return y(),L("main",null,[a(we,null,{left:v(()=>{var s,l,$,A,N;return[r("div",Me,[a(o,{name:"arrow-left",size:"20",onClick:e[0]||(e[0]=ze=>c(h).back())}),r("div",{class:"user-info flex items-center w-52 ml-2",onClick:R},[a(n,{class:"flex-none w-8 aspect-square",round:"",fit:"cover",src:(l=(s=c(u))==null?void 0:s.user_info)==null?void 0:l.avatar_url},null,8,["src"]),r("div",Oe,[r("h4",$e,I((A=($=c(u))==null?void 0:$.user_info)==null?void 0:A.nickname),1),r("span",Ae,I(c(Ce)((N=c(u))==null?void 0:N.created_at)),1)])])])]}),right:v(()=>[U.value?(y(),T(i,{key:1,onClick:e[1]||(e[1]=s=>{var l;return t.$router.push(`/chat/${(l=g.value)==null?void 0:l.user_id}`)}),class:"w-20",type:"success",round:"",plain:"",size:"small"},{default:v(()=>[D("私信")]),_:1})):(y(),T(i,{key:0,onClick:c(H),class:"w-20",icon:"plus",type:"primary",round:"",plain:"",size:"small"},{default:v(()=>[D("关注")]),_:1},8,["onClick"]))]),_:1}),a(f,{height:"50px"}),r("div",Ne,[r("div",Ve,[r("div",Le,I((M=c(u))==null?void 0:M.content),1),r("div",Ee,[(y(!0),L(le,null,ce((O=c(u))==null?void 0:O.images,(s,l)=>(y(),T(n,{key:s.image_id,onClick:()=>G(l),class:"w-full aspect-square rounded-lg",round:"",radius:8,fit:"cover",src:s.image_url},null,8,["onClick","src"]))),128))])]),a(W,{style:{color:"#d3d",borderColor:"#ddf"}},{default:v(()=>{var s,l;return[r("h4",null,"共"+I((l=(s=c(u))==null?void 0:s.comments)==null?void 0:l.length)+"条评论",1)]}),_:1}),r("div",qe,[a(ge,{loading:m.loading,"onUpdate:loading":e[2]||(e[2]=s=>m.loading=s),finished:m.finished,"onUpdate:finished":e[3]||(e[3]=s=>m.finished=s),error:m.error,"onUpdate:error":e[4]||(e[4]=s=>m.error=s),"comment-list":b.value,"handle-comment-on-load":j},null,8,["loading","finished","error","comment-list"])])]),a(f,{height:"50px"}),a(Y,{class:"p-2"},{default:v(()=>[a(X,{class:"flex-1 m-2 rounded-md outline outline-1 outline-blue-300",modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=s=>w.value=s),"left-icon":"edit",placeholder:"说点啥"},null,8,["modelValue"]),a(i,{class:"flex-none",type:"primary",onClick:K},{default:v(()=>[D("发送")]),_:1}),a(F,{class:"flex-none",color:"#1989fa",icon:P.value?"like":"like-o",text:`${B.value}`,onClick:c(Q)},null,8,["icon","text","onClick"]),a(F,{class:"flex-none",icon:"share-o",text:"分享",onClick:e[6]||(e[6]=()=>C.isShow=!0)})]),_:1}),a(Z,{show:C.isShow,"onUpdate:show":e[7]||(e[7]=s=>C.isShow=s),title:"立即分享给好友",options:C.shareOptions},null,8,["show","options"])])}}});export{ao as default};
