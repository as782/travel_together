import{O as fe,d as ue,r as M,J as _e,P as pe,Q as ve,T as me,U as xe,q as de,V as he,W as ge,b as d,X as ne,I as W,Y as oe,Z as re,$ as ye,a0 as we,a1 as Ie,v as be,G as ke,c as m,w as b,a2 as Me,f as Te,o as _,D as ce,C as le,B as ie,a,E as u,a3 as k,u as N,g as R,p as Se,e as Ce,i as Ne}from"./index-Al1ESLyH.js";import{L as Re}from"./index-DVp0JOWu.js";import{T as Ee}from"./index-BPo13gx-.js";/* empty css              */import{g as De,M as D}from"./index-BXhODArz.js";import{u as Le}from"./message-BTh5o252.js";import{g as Oe}from"./tool-DO7ubHTV.js";import{S as Pe,a as Be}from"./index-uvLI7Ok2.js";import{S as Ve}from"./index-B3c1HLcr.js";import{I as Ae}from"./index-o3mCI9mj.js";import"./use-tab-status-CfkwxFsA.js";const[Ge,L]=fe("notice-bar"),We={text:String,mode:String,color:String,delay:ne(1),speed:ne(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var $e=ue({name:Ge,props:We,emits:["close","replay"],setup(o,{emit:E,slots:p}){let x=0,f=0,T;const S=M(),n=M(),c=_e({show:!0,offset:0,duration:0}),C=()=>{if(p["left-icon"])return p["left-icon"]();if(o.leftIcon)return d(W,{class:L("left-icon"),name:o.leftIcon},null)},V=()=>{if(o.mode==="closeable")return"cross";if(o.mode==="link")return"arrow"},A=t=>{o.mode==="closeable"&&(c.show=!1,E("close",t))},O=()=>{if(p["right-icon"])return p["right-icon"]();const t=V();if(t)return d(W,{name:t,class:L("right-icon"),onClick:A},null)},G=()=>{c.offset=x,c.duration=0,ye(()=>{re(()=>{c.offset=-f,c.duration=(f+x)/+o.speed,E("replay")})})},P=()=>{const t=o.scrollable===!1&&!o.wrapable,e={transform:c.offset?`translateX(${c.offset}px)`:"",transitionDuration:`${c.duration}s`};return d("div",{ref:S,role:"marquee",class:L("wrap")},[d("div",{ref:n,style:e,class:[L("content"),{"van-ellipsis":t}],onTransitionend:G},[p.default?p.default():o.text])])},s=()=>{const{delay:t,speed:e,scrollable:l}=o,i=we(t)?+t*1e3:0;x=0,f=0,c.offset=0,c.duration=0,clearTimeout(T),T=setTimeout(()=>{if(!S.value||!n.value||l===!1)return;const r=oe(S).width,v=oe(n).width;(l||v>r)&&re(()=>{x=r,f=v,c.offset=-f,c.duration=f/+e})},i)};return pe(s),ve(s),me("pageshow",s),xe({reset:s}),de(()=>[o.text,o.scrollable],s),()=>{const{color:t,wrapable:e,background:l}=o;return he(d("div",{role:"alert",class:L({wrapable:e}),style:{color:t,background:l}},[C(),P(),O()]),[[ge,c.show]])}}});const qe=Ie($e),Ue=o=>(Se("data-v-d965a985"),o=o(),Ce(),o),Ye={class:"bg-white"},je={class:"w-full flex justify-between",style:{width:"100%"}},Fe={class:"flex justify-center items-center"},Ke={class:"text-xs text-blue-500 mx-2"},Xe={class:"mx-2 flex-1"},ze={class:"flex justify-between mb-1"},Je=Ue(()=>a("h4",{class:"text-sm text-left font-black"},u("最新动态"),-1)),Qe={class:"user-state text-xs text-left text-gray-500"},Ze={key:0,class:"text-xs truncate text-left text-gray-500"},He={key:1,class:"text-xs truncate text-left text-gray-500"},et={class:"text-blue-300"},tt={key:2,class:"text-xs truncate text-left text-gray-500"},st={class:"text-blue-300"},at={key:3,class:"text-xs truncate text-left text-gray-500"},nt={class:"text-blue-300"},ot={key:4,class:"text-xs truncate text-left text-gray-500"},rt={class:"text-blue-300"},ct={key:5,class:"text-xs truncate text-left text-gray-500"},lt={class:"text-blue-300"},it=["onClick"],ut={class:"mx-2 flex-1"},dt={class:"flex justify-between mb-1"},ft={class:"text-sm text-left"},_t={class:"user-state text-xs text-left text-gray-500"},pt={class:"flex"},vt={class:"text-xs truncate text-left text-gray-500"},mt=ue({__name:"MessagePage",setup(o){be(()=>{c()});const E=Te(),p=ke(),x=Le(),f=M(),T=M([]),S=M([]),n=M([]);de(f,()=>{const s=f.value.messages.send,t=f.value.messages.received,e=G(s,t);T.value=e.map(i=>{var r;return P(i,(r=p.userInfo)==null?void 0:r.user_id)}),T.value.map(i=>{x.setContactedUserMap(i.userInfo.user_id,i.userInfo)});const l=f.value.interactive;n.value=l.map(i=>{var r;return P(i,(r=p.userInfo)==null?void 0:r.user_id)})});const c=async()=>{var t;await x.getNotice((t=p.userInfo)==null?void 0:t.user_id),f.value=x.pageNotices.data;const s=await De();S.value=s.data.list.map(e=>({id:e.id,content:e.content,userInfo:{user_id:e.admin_id,nickname:e.userInfo.nickname,avatar_url:e.userInfo.avatar_url}}))},C=M(!1),V=()=>{C.value=!0,x.pageNotices.status="idle",c().finally(()=>{setTimeout(()=>{C.value=!1},1e3)})},A=s=>{const{userInfo:{user_id:t}}=s;E.push(`chat/${t}`)};function O(s,t){const e=new Map;return s.forEach(l=>{const i=t?l.sender_id:l.receiver_id,r=e.get(i)||[];r.push(l),e.set(i,r)}),e}function G(s,t){const e=new Map;return O(s,!1).forEach((r,v)=>{const w=r.reduce((g,I)=>new Date(I.created_at)>new Date(g.created_at)?I:g);e.set(v,w)}),O(t,!0).forEach((r,v)=>{const w=r.reduce((I,B)=>new Date(B.created_at)>new Date(I.created_at)?B:I),g=e.get(v);g?e.set(v,g.created_at>w.created_at?g:w):e.set(v,w)}),Array.from(e.values())}function P(s,t){const e=t===s.receiver_id,l={user_id:e?s.sender_id:s.receiver_id,nickname:e?s.sender_nickname:s.receiver_nickname,avatar_url:e?s.sender_avatar:s.receiver_avatar};return{id:s.id,userInfo:l,isRev:e,content:s.content,type:s.type,created_at:Oe(s.created_at)}}return(s,t)=>{const e=Ae,l=Pe,i=Be,r=qe,v=Ve,w=W,g=Ee,I=Re,B=Me;return _(),m("main",Ye,[d(v,{"offset-top":50},{default:b(()=>[d(r,{class:"notice-bar","left-icon":"volume-o",background:"#ecf9ff",scrollable:!1},{default:b(()=>[d(i,{vertical:"",autoplay:3e3,touchable:!1,"show-indicators":!1},{default:b(()=>[(_(!0),m(ce,null,le(S.value,h=>(_(),ie(l,{key:h.id,class:"w-full flex items-center"},{default:b(()=>[a("div",je,[a("span",null,u(h.content),1),a("div",Fe,[a("span",Ke,"------"+u(h.userInfo.nickname),1),d(e,{class:"flex-none w-5 aspect-square shadow-lg shadow-slate-400",round:"",fit:"cover",src:h.userInfo.avatar_url},null,8,["src"])])])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),d(B,{class:"flex-1",modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=h=>C.value=h),onRefresh:V},{default:b(()=>{var h,$,q,U,Y,j,F,K,X,z,J,Q,Z,H,ee,te,se,ae;return[a("div",{class:"system-info flex p-2 m-2 border shadow-md",onClick:t[0]||(t[0]=y=>N(E).push("/aboutmoment"))},[d(w,{name:"bell",class:"flex-none",size:"40",color:"#7fab50"}),a("div",Xe,[a("div",ze,[Je,a("span",Qe,u(((h=n.value[0])==null?void 0:h.created_at)||""),1)]),n.value.length?k("",!0):(_(),m("p",Ze," 无动态 ")),(($=n.value[0])==null?void 0:$.type)===N(D).TEAM_ACTIVITY_POST_COMMENT?(_(),m("p",He,[a("span",et,u((U=(q=n.value[0])==null?void 0:q.userInfo)==null?void 0:U.nickname),1),R(" 评论了你的组队："+u((Y=n.value[0])==null?void 0:Y.content),1)])):k("",!0),((j=n.value[0])==null?void 0:j.type)===N(D).DYNAMIC_POST_COMMENT?(_(),m("p",tt,[a("span",st,u((K=(F=n.value[0])==null?void 0:F.userInfo)==null?void 0:K.nickname),1),R(" 评论了你的动态："+u((X=n.value[0])==null?void 0:X.content),1)])):k("",!0),((z=n.value[0])==null?void 0:z.type)===N(D).TEAM_ACTIVITY_POST_LIKE?(_(),m("p",at,[a("span",nt,u((Q=(J=n.value[0])==null?void 0:J.userInfo)==null?void 0:Q.nickname),1),R(" 点赞了你的组队 ")])):k("",!0),((Z=n.value[0])==null?void 0:Z.type)===N(D).DYNAMIC_POST_LIKE?(_(),m("p",ot,[a("span",rt,u((ee=(H=n.value[0])==null?void 0:H.userInfo)==null?void 0:ee.nickname),1),R(" 点赞了你的动态 ")])):k("",!0),((te=n.value[0])==null?void 0:te.type)===N(D).FOLLOW_NOTIFICATION?(_(),m("p",ct,[a("span",lt,u((ae=(se=n.value[0])==null?void 0:se.userInfo)==null?void 0:ae.nickname),1),R(" 关注了你 ")])):k("",!0)])]),d(I,null,{default:b(()=>[(_(!0),m(ce,null,le(T.value,y=>(_(),m("div",{key:y.id,class:"user-info flex p-2 m-2 shadow-md border rounded-md border-gray-300",onClick:xt=>A(y)},[d(e,{class:"flex-none w-12 aspect-square shadow-lg shadow-slate-400",round:"",fit:"cover",src:y.userInfo.avatar_url},null,8,["src"]),a("div",ut,[a("div",dt,[a("h4",ft,u(y.userInfo.nickname),1),a("span",_t,u(y.created_at),1)]),a("div",pt,[y.isRev?k("",!0):(_(),ie(g,{key:0,class:"mx-2",mark:"",type:"success"},{default:b(()=>[R("我说")]),_:1})),a("p",vt,u(y.content),1)])])],8,it))),128))]),_:1})]}),_:1},8,["modelValue"])])}}}),Nt=Ne(mt,[["__scopeId","data-v-d965a985"]]);export{Nt as default};
