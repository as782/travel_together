import{d as at,J as S,c as M,b as m,w as A,K as X,aT as gt,V as wt,W as yt,a as e,o as C,g as E,i as Ct,G as xt,A as Y,v as Z,r as f,aB as kt,a6 as bt,q as St,s as U,H as Bt,u as I,E as h,D as tt,C as et,B as j,a3 as Pt,f as Tt,I as Ut,aA as Lt,M as Dt}from"./index-Al1ESLyH.js";import{A as Ft}from"./index-Crpe8AyD.js";import{_ as It}from"./CommentPlane.vue_vue_type_script_setup_true_lang-wUZzw904.js";import{_ as Mt}from"./PublishCard.vue_vue_type_script_setup_true_lang-Ba3tMeEd.js";import{E as zt}from"./index-C4YkaPVR.js";import{T as Ot}from"./index-BPo13gx-.js";import{S as jt}from"./index-D0XsUnBT.js";import{l as At,b as Et,e as Nt,d as Rt}from"./index-Bc0MyXRq.js";import{B as Vt}from"./index-dW7UAVpM.js";import{S as st}from"./index-BKOHJvEI.js";import{c as $t}from"./tool-DO7ubHTV.js";import{l as ot}from"./lodash-TVC-EY0t.js";import"./index-DVp0JOWu.js";import"./use-tab-status-CfkwxFsA.js";import"./index-o3mCI9mj.js";import"./index-BXtSv6Ia.js";import"./GroupInfoCard.vue_vue_type_script_setup_true_lang-Dbxb_lqa.js";const qt={class:"container"},Gt=at({__name:"ChatAndFollowButton",props:{leftBtnType:{},rightBtnType:{},isFollow:{type:Boolean}},emits:["leftBtnClick","rightBtnClick"],setup(N,{emit:v}){const x=N,_=v,p=S({"btn-color-primary":x.leftBtnType==="primary","btn-color-success":x.leftBtnType==="success"}),g=S({"btn-color-primary":x.rightBtnType==="primary","btn-color-success":x.rightBtnType==="success"}),B=()=>{_("rightBtnClick")},z=()=>{_("leftBtnClick")};return(i,R)=>{const k=Vt;return C(),M("div",qt,[m(k,{class:X(["cos-button",p]),style:gt({width:i.isFollow?"240px":""}),onClick:z},{default:A(()=>[E("私聊")]),_:1},8,["style","class"]),wt(e("button",{class:X(["cos-button",g]),onClick:B}," 关注 ",2),[[yt,!i.isFollow]])])}}}),Ht=Ct(Gt,[["__scopeId","data-v-169364d0"]]),Jt={class:"fixed z-50 top-0 w-full h-10 py-2 bg-transparent"},Kt={class:"flex justify-between"},Wt={class:"bg-gray-600 bg-opacity-20 m-2 rounded-full w-12 aspect-square flex items-center justify-center"},Qt={class:"bg-gray-600 bg-opacity-20 m-2 rounded-full w-12 aspect-square flex items-center justify-center"},Xt=e("div",{class:"up-bg-img w-full -z-10",style:{height:"50vh"}},[e("img",{class:"w-full h-full object-cover",src:"https://img.pconline.com.cn/images/upload/upc/tx/photoblog/1407/12/c4/36240468_36240468_1405175533420_mthumb.jpg",alt:"backgrond img"})],-1),Yt={class:"down-content p-4 -translate-y-12"},Zt={class:"card-profile rounded-lg bg-white"},te={class:"profile-top flex flex-row-reverse w-full p-2"},ee={class:"-translate-y-8 flex flex-none justify-center items-center w-16 h-16 rounded-full bg-white shadow-lg"},se=["src"],oe={class:"flex-none"},ae={class:"text-lg font-bold"},ne={class:"text-sm"},le={class:"profile-center px-2"},ie={class:"w-full"},ce={class:"text-left text-sm text-slate-500"},re={class:"h-4 text-center",style:{"font-size":"8px"}},de={class:"proflie-bottom p-2"},ue={class:"flex justify-between items-center"},me={class:"flex-1 text-xs"},_e={class:"text-blue-500"},pe={class:"flex flex-none items-center"},fe={class:"flex flex-col items-center flex-none mx-2"},he={class:"text-sm"},ve=e("div",{class:"text-xs"},"关注",-1),ge={class:"flex flex-col items-center flex-none mx-2"},we={class:"text-sm"},ye=e("div",{class:"text-xs"},"粉丝",-1),Ce={class:"flex flex-col items-center flex-none mx-2"},xe={class:"text-sm"},ke=e("div",{class:"text-xs"},"喜欢",-1),be={class:"my-2"},Se=e("h4",{class:"text-gray-500 text-sm"},"我的发布",-1),$e=at({__name:"OtherProfile",setup(N){const v=Tt(),x=Lt(),_=xt(),p=Y(()=>Number(x.params.id)),g=S({isShow:!1,shareOptions:st}),B=S({isShow:!1,shareOptions:st}),z=()=>{g.isShow=!0};Z(()=>{R(p.value)});const i=f(),R=async s=>{try{let t=await kt(s);i.value=t.data}catch(t){console.error(t)}};Z(()=>{p.value&&ct(p.value)});const k=f([]),w=S({}),V=S({}),nt=async s=>(await Et(s)).data,lt=async()=>{const s=l.value.post_id,t={page:l.value.currentPage,limit:l.value.pageSize,post_id:l.value.post_id};let c=await Rt(t);const d=c.data.list.map(y=>{const{comment_id:u,user_info:n,content:o,created_at:b}=y;return{comment_id:u,userInfo:n,content:o,createTime:b}});w[s]&&w[s].length<=l.value.total?w[s]=w[s].concat(d):w[s]||(w[s]=d),L.value=w[s],l.value.total=c.data.totalCount,l.value.pageSize=c.data.pageSize,l.value.currentPage=c.data.currentPage,r.value.loading=!1,r.value.finished=L.value.length>=l.value.total},it=async s=>{let t=await Nt(s);V[s]=t.data},ct=async(s,t=1,c=10)=>{const y=(await bt({user_id:s,page:t,limit:c})).data.list.map(async n=>{var b;const o=(b=i.value)==null?void 0:b.user_info;if(n.post_id){const T=await nt(n.post_id);return{type:"group",data:{card_id:n.post_id,userInfo:{user_id:(o==null?void 0:o.user_id)??0,nickname:(o==null?void 0:o.nickname)??"Unkonw",avatar_url:(o==null?void 0:o.avatar_url)??"",likeFans:T},condition:{destination:[n.start_location,n.end_location],time:n.duration_day},desc:n.title,cover_imgUrl:n.images[0].image_url,createTime:n.created_at}}}else{await it(n.dynamic_post_id);const T=V[n.dynamic_post_id].some(F=>F.user_id===(o==null?void 0:o.user_id));return{type:"moment",data:{card_id:n.dynamic_post_id,userInfo:{user_id:(o==null?void 0:o.user_id)??0,nickname:(o==null?void 0:o.nickname)??"Unkonw",avatar_url:(o==null?void 0:o.avatar_url)??""},isFollow:!1,isLike:T,content:{desc:n.content,images:n.images},createTime:n.created_at,likeCount:n.like_count,commentCount:n.comment_count}}}}),u=await Promise.all(y);k.value=u},P=f([]);St(k,s=>{P.value=s.filter(t=>t.type==="moment")});const L=f([]),r=f({loading:!1,finished:!1,error:!1}),l=f({currentPage:1,pageSize:10,total:-1,post_id:-1}),rt=()=>{r.value.loading=!1,r.value.finished=!1,r.value.error=!1,l.value.currentPage=1,l.value.pageSize=10,l.value.total=-1,l.value.post_id=-1},O=f(!1),dt=async()=>{await lt(),l.value.currentPage++},ut=async s=>{O.value=!0,rt(),l.value.post_id=s,L.value=[]},mt=ot.debounce(async s=>{const t=_.userInfo,c={post_id:s,user_id:t==null?void 0:t.user_id};try{const d=await At(c);P.value.forEach((y,u)=>{y.data.card_id===s&&(P.value[u].data.likeCount+=d.data,P.value[u].data.isLike=!P.value[u].data.isLike)}),U(d.msg)}catch{U("操作失败")}},200),_t=()=>{g.isShow=!0},pt=(s,t)=>{t==="moment"&&v.push("/momentdetail"+s)},ft=Y(()=>_.myFollows.data.some(s=>s.user_id===p.value)),$=f(ft.value),ht=()=>{if(!_.userInfo){U("请先登录"),v.push("/login");return}v.push("/chat/"+p.value)},vt=ot.debounce(async()=>{const s=_.userInfo;if(!s){U("请先登录"),v.push("/login");return}const t={follower_id:s==null?void 0:s.user_id,following_id:p.value,action:1};try{await Bt(t),_.getMyFollows(),$.value=!0}catch{U("操作失败")}},200);return(s,t)=>{var D,F,q,G,H,J,K,W,Q;const c=Ut,d=jt,y=Dt,u=Ot,n=zt,o=Mt,b=It,T=Ft;return C(),M("main",null,[e("div",Jt,[e("div",Kt,[e("div",Wt,[m(c,{onClick:t[0]||(t[0]=a=>I(v).back()),class:"mx-2",color:"#fff",name:"arrow-left",size:"30"})]),e("div",Qt,[m(c,{onClick:z,class:"mx-2",color:"#fff",name:"share-o",size:"30"})])]),m(d,{show:g.isShow,"onUpdate:show":t[1]||(t[1]=a=>g.isShow=a),title:"立即分享给好友",options:g.shareOptions},null,8,["show","options"])]),Xt,e("div",Yt,[e("div",Zt,[e("div",te,[e("div",ee,[e("img",{class:"w-4/5 h-4/5 rounded-full",src:(D=i.value)==null?void 0:D.user_info.avatar_url,alt:"avatar"},null,8,se)]),m(y,{class:"flex-1"}),e("div",oe,[e("div",ae,h((F=i.value)==null?void 0:F.user_info.nickname),1),e("div",ne,"ID:"+h((q=i.value)==null?void 0:q.user_info.user_id),1)])]),e("div",le,[e("div",ie,[e("div",ce,h((G=i.value)==null?void 0:G.bio),1),(C(!0),M(tt,null,et((H=i.value)==null?void 0:H.tags,a=>(C(),j(u,{key:a.tag_id,class:"mx-1",round:"",color:"#ffe1e1","text-color":"#ad0000"},{default:A(()=>[e("span",re,h(a.tag_name),1)]),_:2},1024))),128))])]),e("div",de,[e("div",ue,[e("span",me,[E(" 一起旅行了 "),e("strong",_e,h(I($t)((J=i.value)==null?void 0:J.created_at)),1),E(" 天 ")]),e("div",pe,[e("div",fe,[e("div",he,h((K=i.value)==null?void 0:K.followCount),1),ve]),e("div",ge,[e("div",we,h((W=i.value)==null?void 0:W.fansCount),1),ye]),e("div",Ce,[e("div",xe,h((Q=i.value)==null?void 0:Q.likeCount),1),ke])])])])]),e("div",be,[Se,k.value.length?Pt("",!0):(C(),j(n,{key:0,class:"my-4 bg-white rounded-md",description:"未发布任何内容"})),(C(!0),M(tt,null,et(k.value,a=>(C(),j(o,{key:a.id,class:"my-4","card-data":a.data,type:a.type,onClick:()=>pt(a.data.card_id,a.type),onClickLike:()=>I(mt)(a.data.card_id),onClickShare:_t,onClickComment:()=>ut(a.data.card_id)},null,8,["card-data","type","onClick","onClickLike","onClickComment"]))),128))]),m(d,{show:B.isShow,"onUpdate:show":t[2]||(t[2]=a=>B.isShow=a),title:"立即分享给好友",options:B.shareOptions},null,8,["show","options"])]),m(T,{class:"h-screen",show:O.value,"onUpdate:show":t[6]||(t[6]=a=>O.value=a),title:"评论"},{default:A(()=>[m(b,{loading:r.value.loading,"onUpdate:loading":t[3]||(t[3]=a=>r.value.loading=a),finished:r.value.finished,"onUpdate:finished":t[4]||(t[4]=a=>r.value.finished=a),error:r.value.error,"onUpdate:error":t[5]||(t[5]=a=>r.value.error=a),"comment-list":L.value,"handle-comment-on-load":dt},null,8,["loading","finished","error","comment-list"])]),_:1},8,["show"]),m(Ht,{"left-btn-type":"primary","right-btn-type":"success","is-follow":$.value,onLeftBtnClick:ht,onRightBtnClick:I(vt)},null,8,["is-follow","onRightBtnClick"])])}}});export{$e as default};
