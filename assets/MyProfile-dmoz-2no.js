import{d as _e,a4 as pe,G as fe,a5 as ve,A,J as P,r as w,q as he,s as L,c as D,a as s,b as d,u as c,E as v,D as O,C as q,g as N,B as j,a3 as ge,w as U,f as xe,o as y,M as we,h as R,a6 as ye,I as ke}from"./index-Al1ESLyH.js";import{A as Ce}from"./index-Crpe8AyD.js";import{E as Se}from"./index-C4YkaPVR.js";import{T as be}from"./index-BPo13gx-.js";import{S as Pe}from"./index-D0XsUnBT.js";import{_ as Le}from"./PublishCard.vue_vue_type_script_setup_true_lang-Ba3tMeEd.js";import{c as Me}from"./tool-DO7ubHTV.js";import{l as Te,b as ze,d as De,e as je,f as Ue,h as Ee}from"./index-Bc0MyXRq.js";import{S as V}from"./index-BKOHJvEI.js";import{l as Be}from"./lodash-TVC-EY0t.js";import{_ as Fe}from"./CommentPlane.vue_vue_type_script_setup_true_lang-wUZzw904.js";import{a as G}from"./index-ClZHhhvi.js";import"./index-BXtSv6Ia.js";import"./GroupInfoCard.vue_vue_type_script_setup_true_lang-Dbxb_lqa.js";import"./index-o3mCI9mj.js";import"./index-DVp0JOWu.js";import"./use-tab-status-CfkwxFsA.js";import"./index-dW7UAVpM.js";import"./index-DEValKwa.js";import"./index-BVAKaSy2.js";const $e={class:"fixed z-50 top-0 w-full h-10 py-2 bg-transparent"},Ae={class:"flex justify-between"},Oe={class:"bg-gray-600 bg-opacity-20 m-2 rounded-full w-12 aspect-square flex items-center justify-center"},qe={class:"bg-gray-600 bg-opacity-20 m-2 rounded-full w-12 aspect-square flex items-center justify-center"},Ne=s("div",{class:"up-bg-img w-full -z-10",style:{height:"50vh"}},[s("img",{class:"w-full h-full object-cover",src:"https://img.pconline.com.cn/images/upload/upc/tx/photoblog/1407/12/c4/36240468_36240468_1405175533420_mthumb.jpg",alt:"backgrond img"})],-1),Re={class:"down-content p-4 -translate-y-12"},Ve={class:"card-profile rounded-lg bg-white"},Ge={class:"profile-top flex flex-row-reverse w-full p-2"},He={class:"-translate-y-8 flex flex-none justify-center items-center w-16 h-16 rounded-full bg-white shadow-lg"},Je=["src"],Ke={class:"flex-none"},Qe={class:"text-lg font-bold"},We={class:"text-sm"},Xe={class:"profile-center px-2"},Ye={class:"w-full"},Ze={class:"text-left text-sm text-slate-500"},Ie={class:"h-4 text-center",style:{"font-size":"8px"}},et={class:"proflie-bottom p-2"},tt={class:"flex justify-between items-center"},st={class:"flex-1 text-xs"},at={class:"text-blue-500"},ot={class:"flex flex-none items-center"},nt={class:"text-sm"},lt=s("div",{class:"text-xs"},"关注",-1),it={class:"text-sm"},ct=s("div",{class:"text-xs"},"粉丝",-1),rt={class:"text-sm"},dt=s("div",{class:"text-xs"},"喜欢",-1),ut={class:"flex justify-around p-2 my-4 rounded-lg bg-white"},mt=s("span",{class:"text-sm text-gray-500"}," 我的组队",-1),_t=s("span",{class:"text-sm text-gray-500"}," 系统设置",-1),pt=s("span",{class:"text-sm text-gray-500"},"个人资料",-1),ft=s("h4",{class:"text-gray-500 text-sm"},"我的发布",-1),$t=_e({__name:"MyProfile",setup(vt){pe(()=>{var e;console.log("mounted");const t=(e=a==null?void 0:a.value)==null?void 0:e.user_id;t&&oe(t),H(),J(),K()});const u=xe(),E=fe(),{getMyFans:H,getMyFollows:J,getMylikePostList:K}=E,{userInfo:a,myFans:Q,myFollows:W,myLikeGroupPostList:X,myLikeMomentPostList:Y}=ve(E),M=A(()=>{const t=Q.value.data.length,e=W.value.data.length,l=X.value.data.length+Y.value.data.length;return{fansCount:t,followCount:e,likeCount:l}}),k=P({isShow:!1,shareOptions:V}),T=P({isShow:!1,shareOptions:V}),Z=()=>{u.push("/chat/12")},I=()=>{k.isShow=!0},ee=A(()=>{var t;return((t=a==null?void 0:a.value)==null?void 0:t.tags)||[]}),f=w([]),h=P({}),B=P({}),te=async t=>(await ze(t)).data,se=async()=>{const t=i.value.post_id,e={page:i.value.currentPage,limit:i.value.pageSize,post_id:i.value.post_id};let l=await De(e);const r=l.data.list.map(p=>{const{comment_id:g,user_info:n,content:_,created_at:x}=p;return{comment_id:g,userInfo:n,content:_,createTime:x}});h[t]&&h[t].length<=i.value.total?h[t]=h[t].concat(r):h[t]||(h[t]=r),S.value=h[t],i.value.total=l.data.totalCount,i.value.pageSize=l.data.pageSize,i.value.currentPage=l.data.currentPage,m.value.loading=!1,m.value.finished=S.value.length>=i.value.total},ae=async t=>{let e=await je(t);B[t]=e.data},oe=async(t,e=1,l=100)=>{const p=(await ye({user_id:t,page:e,limit:l})).data.list.map(async n=>{if(n.post_id){const _=await te(n.post_id);return{type:"group",data:{card_id:n.post_id,status:n.status,userInfo:{user_id:(a==null?void 0:a.value.user_id)??0,nickname:(a==null?void 0:a.value.nickname)??"Unkonw",avatar_url:(a==null?void 0:a.value.avatar_url)??"",likeFans:_},condition:{destination:[n.start_location,n.end_location],time:n.duration_day},desc:n.title,cover_imgUrl:n.images[0].image_url,createTime:n.created_at}}}else{await ae(n.dynamic_post_id);const _=B[n.dynamic_post_id].some(b=>b.user_id===(a==null?void 0:a.value.user_id));return{type:"moment",data:{card_id:n.dynamic_post_id,status:n.status,userInfo:{user_id:(a==null?void 0:a.value.user_id)??0,nickname:(a==null?void 0:a.value.nickname)??"Unknow",avatar_url:(a==null?void 0:a.value.avatar_url)??""},isFollow:!1,isLike:_,content:{desc:n.content,images:n.images},createTime:n.created_at,likeCount:n.like_count,commentCount:n.comment_count}}}}),g=await Promise.all(p);g.sort((n,_)=>new Date(_.data.createTime).getTime()-new Date(n.data.createTime).getTime()),f.value=g},C=w([]);he(f,t=>{C.value=t.filter(e=>e.type==="moment")});const S=w([]),m=w({loading:!1,finished:!1,error:!1}),i=w({currentPage:1,pageSize:10,total:-1,post_id:-1}),ne=()=>{m.value.loading=!1,m.value.finished=!1,m.value.error=!1,i.value.currentPage=1,i.value.pageSize=10,i.value.total=-1,i.value.post_id=-1},z=w(!1),le=async()=>{await se(),i.value.currentPage++},ie=async t=>{z.value=!0,ne(),i.value.post_id=t,S.value=[]},ce=Be.debounce(async t=>{const e={post_id:t,user_id:a.value.user_id};try{const l=await Te(e);C.value.forEach((r,p)=>{r.data.card_id===t&&(C.value[p].data.likeCount+=l.data,C.value[p].data.isLike=!C.value[p].data.isLike)}),L(l.msg)}catch{L("操作失败")}},200),re=()=>{k.isShow=!0},de=(t,e)=>{e==="moment"?u.push("/momentdetail/"+t):e==="group"&&u.push("/groupdetail/"+t)},ue=async(t,e)=>{e==="moment"?G({title:"提示",message:"确定删除该动态吗？",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{await Ue({ids:[t]}),L("删除成功"),f.value.forEach((l,r)=>{l.data.card_id===t&&f.value.splice(r,1)})}):e==="group"&&G({title:"提示",message:"确定删除该帖子吗？",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{await Ee({ids:[t]}),L("删除成功"),f.value.forEach((l,r)=>{l.data.card_id===t&&f.value.splice(r,1)})})},me=(t,e)=>{e==="moment"?u.push("/publishmoment/"+t):e==="group"&&u.push("/publishgroup/"+t)};return(t,e)=>{var _,x,b,F,$;const l=ke,r=Pe,p=be,g=Se,n=Ce;return y(),D("main",null,[s("div",$e,[s("div",Ae,[s("div",Oe,[d(l,{onClick:Z,class:"mx-2",color:"#fff",name:"service-o",size:"30"})]),s("div",qe,[d(l,{onClick:I,class:"mx-2",color:"#fff",name:"share-o",size:"30"})])]),d(r,{show:k.isShow,"onUpdate:show":e[0]||(e[0]=o=>k.isShow=o),title:"立即分享给好友",options:k.shareOptions},null,8,["show","options"])]),Ne,s("div",Re,[s("div",Ve,[s("div",Ge,[s("div",He,[s("img",{class:"w-4/5 h-4/5 rounded-full",src:(_=c(a))==null?void 0:_.avatar_url,alt:"avatar"},null,8,Je)]),d(we,{class:"flex-1"}),s("div",Ke,[s("div",Qe,v((x=c(a))==null?void 0:x.nickname),1),s("div",We,"ID:"+v((b=c(a))==null?void 0:b.user_id),1)])]),s("div",Xe,[s("div",Ye,[s("div",Ze,v(((F=c(a))==null?void 0:F.bio)||"这个人很懒，什么都没有留下"),1),(y(!0),D(O,null,q(ee.value,o=>(y(),j(p,{key:o.id,class:"mx-1",round:"",color:"#ffe1e1","text-color":"#ad0000"},{default:U(()=>[s("span",Ie,v(o.tag_name),1)]),_:2},1024))),128))])]),s("div",et,[s("div",tt,[s("span",st,[N(" 一起旅行了 "),s("strong",at,v(c(Me)(($=c(a))==null?void 0:$.created_at)),1),N(" 天 ")]),s("div",ot,[s("div",{onClick:e[1]||(e[1]=o=>c(u).push("/follow")),class:"flex flex-col items-center flex-none mx-2"},[s("div",nt,v(M.value.followCount),1),lt]),s("div",{onClick:e[2]||(e[2]=o=>c(u).push("/fans")),class:"flex flex-col items-center flex-none mx-2"},[s("div",it,v(M.value.fansCount),1),ct]),s("div",{onClick:e[3]||(e[3]=o=>c(u).push("/like")),class:"flex flex-col items-center flex-none mx-2"},[s("div",rt,v(M.value.likeCount),1),dt])])])])]),s("div",ut,[s("div",{onClick:e[4]||(e[4]=o=>c(u).push("/myjoinedgroups")),class:"flex flex-col justify-center items-center w-20 rounded-sm"},[d(l,{name:"friends-o",size:"30"}),mt]),s("div",{onClick:e[5]||(e[5]=o=>c(u).push("/setting")),class:"flex flex-col justify-center items-center w-20 rounded-sm"},[d(l,{name:"setting-o",size:"30"}),_t]),s("div",{onClick:e[6]||(e[6]=o=>c(u).push("/editprofile")),class:"flex flex-col justify-center items-center w-20 rounded-sm"},[d(l,{name:"records-o",size:"30"}),pt])]),s("div",null,[ft,f.value.length?ge("",!0):(y(),j(g,{key:0,class:"my-4",description:"未发布任何内容"})),(y(!0),D(O,null,q(f.value,o=>(y(),j(Le,{key:o.id,class:"my-4","card-data":o.data,type:o.type,onClick:()=>de(o.data.card_id,o.type),onClickLike:()=>c(ce)(o.data.card_id),onClickShare:re,onClickComment:()=>ie(o.data.card_id)},{edit:U(()=>[d(l,{class:"m-2 shadow-md rounded-md",name:"delete-o",size:"25",onClick:R(()=>ue(o.data.card_id,o.type),["stop"])},null,8,["onClick"]),d(l,{class:"m-2 shadow-md rounded-md",name:"edit",size:"25",onClick:R(()=>me(o.data.card_id,o.type),["stop"])},null,8,["onClick"])]),_:2},1032,["card-data","type","onClick","onClickLike","onClickComment"]))),128))]),d(r,{show:T.isShow,"onUpdate:show":e[7]||(e[7]=o=>T.isShow=o),title:"立即分享给好友",options:T.shareOptions},null,8,["show","options"])]),d(n,{class:"h-screen",show:z.value,"onUpdate:show":e[11]||(e[11]=o=>z.value=o),title:"评论"},{default:U(()=>[d(Fe,{loading:m.value.loading,"onUpdate:loading":e[8]||(e[8]=o=>m.value.loading=o),finished:m.value.finished,"onUpdate:finished":e[9]||(e[9]=o=>m.value.finished=o),error:m.value.error,"onUpdate:error":e[10]||(e[10]=o=>m.value.error=o),"comment-list":S.value,"handle-comment-on-load":le},null,8,["loading","finished","error","comment-list"])]),_:1},8,["show"])])}}});export{$t as default};
