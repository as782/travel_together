import{d as A,G as H,a5 as y,r as k,q as v,A as J,J as V,H as x,s as d,c as f,b as u,w as h,f as K,o as c,a as C,D as L,C as S,B as P,u as b}from"./index-Al1ESLyH.js";import{S as W}from"./index-D0XsUnBT.js";/* empty css              *//* empty css              */import{l as F}from"./lodash-TVC-EY0t.js";import{_ as X}from"./MomentsActivityCard.vue_vue_type_script_setup_true_lang-DQiuus_c.js";import{_ as Y}from"./GroupInfoCard.vue_vue_type_script_setup_true_lang-Dbxb_lqa.js";import{u as Z}from"./post-Ds4jAp6n.js";import{l as oo,b as eo}from"./index-Bc0MyXRq.js";import{a as ao,T as to}from"./index-CAMe5tuU.js";import"./index-BXtSv6Ia.js";import"./index-o3mCI9mj.js";import"./index-dW7UAVpM.js";import"./use-tab-status-CfkwxFsA.js";import"./index-uvLI7Ok2.js";import"./index-B3c1HLcr.js";const so={class:"bg-white"},no={class:"p-2"},io={class:"p-2"},Po=A({__name:"LikeListPage",setup(ro){const M=K(),m=Z(),D=H(),{myLikeGroupPostList:T,myLikeMomentPostList:G,myFollows:I,userInfo:_}=y(D),{myLikeGroupPostDetailList:U,myLikeMomentPostDetailList:q}=y(m),B=T.value.data.map(o=>o.post_id),E=G.value.data.map(o=>o.dynamic_post_id),p=k("group");v(p,o=>{o==="group"?m.getMyLikeGroupPostDetailList(B):o==="moment"&&m.getMyLikeMomentPostDetailList(E)},{immediate:!0});const n=k([]),$=J(()=>q.value.data.map(o=>{var s,t;const e=I.value.data.some(r=>r.user_id===o.user_info.user_id),a=o.like_userIds.some(r=>{var g;return r===((g=_.value)==null?void 0:g.user_id)});return{card_id:o.dynamic_post_id,userInfo:o.user_info,content:{desc:o.content,images:o.images},isFollow:e,isLike:a,likeCount:(s=o.like_userIds)==null?void 0:s.length,commentCount:(t=o.comments)==null?void 0:t.length,createTime:o.created_at}}));v($,o=>{n.value=o},{deep:!0});const N=o=>{console.log("momentCard click",o)},l=V({isShow:!1,shareOptions:[[{name:"微信",icon:"wechat"},{name:"朋友圈",icon:"wechat-moments"},{name:"微博",icon:"weibo"},{name:"QQ",icon:"qq"}],[{name:"复制链接",icon:"link"},{name:"分享海报",icon:"poster"},{name:"二维码",icon:"qrcode"},{name:"小程序码",icon:"weapp-qrcode"}]]}),O=F.debounce(async(o,e)=>{var i;const a={follower_id:(i=_.value)==null?void 0:i.user_id,following_id:o,action:1};n.value.forEach((s,t)=>{s.card_id===e&&(n.value[t].isFollow?a.action=0:a.action=1)});try{const s=await x(a);n.value.forEach((t,r)=>{t.card_id===e&&(n.value[r].isFollow=!n.value[r].isFollow,console.log(n.value[r].isFollow))}),d(s.msg)}catch(s){console.log(s),d("操作失败")}},200),Q=F.debounce(async o=>{const e={post_id:o,user_id:_.value.user_id};try{const a=await oo(e);n.value.forEach((i,s)=>{i.card_id===o&&(n.value[s].likeCount+=a.data,n.value[s].isLike=!n.value[s].isLike)}),d(a.msg)}catch{d("操作失败")}},200),R=()=>{l.isShow=!0},w=k([]),j=async o=>(await eo(o)).data;v(U,async o=>{w.value=await Promise.all(o.data.map(async e=>{const{user_info:a}=e,i=await j(e.post_id);return{userInfo:{user_id:(a==null?void 0:a.user_id)??0,nickname:(a==null?void 0:a.nickname)??"Unkonw",avatar_url:(a==null?void 0:a.avatar_url)??"",likeFans:i},card_id:e.post_id,desc:e.title,condition:{destination:[e.start_location,e.end_location],time:`${e.duration_day}`},cover_imgUrl:e.images[0].image_url,createTime:e.created_at||void 0}}))},{immediate:!0});const z=o=>{M.push(`/groupDetail/${o}`)};return(o,e)=>{const a=to,i=ao,s=W;return c(),f("div",so,[u(i,{active:p.value,"onUpdate:active":e[0]||(e[0]=t=>p.value=t),animated:"",sticky:"","lazy-render":!1,"offset-top":50},{default:h(()=>[u(a,{name:"group",title:"组队"},{default:h(()=>[C("div",no,[(c(!0),f(L,null,S(w.value,t=>(c(),P(Y,{key:t.card_id,onClick:r=>z(t.card_id),cardData:t,class:"my-4"},null,8,["onClick","cardData"]))),128))])]),_:1}),u(a,{name:"moment",title:"动态"},{default:h(()=>[C("div",io,[(c(!0),f(L,null,S(n.value,t=>(c(),P(X,{key:t.id,class:"my-2","moment-data":t,onClick:()=>N(t.card_id),onClickLike:()=>b(Q)(t.card_id),onClickShare:R,onClickFollow:()=>b(O)(t.userInfo.user_id,t.card_id)},null,8,["moment-data","onClick","onClickLike","onClickFollow"]))),128))])]),_:1})]),_:1},8,["active"]),u(s,{show:l.isShow,"onUpdate:show":e[1]||(e[1]=t=>l.isShow=t),title:"立即分享给好友",options:l.shareOptions},null,8,["show","options"])])}}});export{Po as default};
