import{d as I,G as Q,r as f,v as W,s as h,H as X,J as Y,c as z,b as d,w as g,f as Z,o as k,a as P,K as O,u as w,D as $,C as E,B as ee,S as ae,L as oe,M as te,i as ne}from"./index-Al1ESLyH.js";import{A as se}from"./index-Crpe8AyD.js";import{S as le}from"./index-D0XsUnBT.js";/* empty css              *//* empty css              */import{L as re}from"./index-DVp0JOWu.js";import{T as ie}from"./TopNav-B1tNCFOC.js";import{_ as ce}from"./MomentsActivityCard.vue_vue_type_script_setup_true_lang-DQiuus_c.js";import{_ as ue}from"./CommentPlane.vue_vue_type_script_setup_true_lang-wUZzw904.js";import{S as de}from"./index-BKOHJvEI.js";import{c as me,l as ve,d as fe}from"./index-Bc0MyXRq.js";import{l as L}from"./lodash-TVC-EY0t.js";import{a as pe,T as ge}from"./index-CAMe5tuU.js";import"./use-tab-status-CfkwxFsA.js";import"./index-BXtSv6Ia.js";import"./index-o3mCI9mj.js";import"./index-dW7UAVpM.js";import"./tool-DO7ubHTV.js";import"./index-uvLI7Ok2.js";import"./index-B3c1HLcr.js";const _e={class:"p-2"},he={class:"flex justify-center items-center w-full"},we={class:""},Ce=I({__name:"MomentPage",setup(Se){const y=Z(),D=Q(),{userInfo:m}=D,s=f([]),_=f("focusman"),M=["focusman","worldman"],b=t=>{if(t=="focusman"&&!m){h("请先登录"),y.push("/login");return}_.value=t,s.value=[],v.value={currentPage:1,pageSize:10,total:-1},c.value={loading:!1,error:!1,finished:!1}};W(()=>{b(M[1]),T()});const c=f({loading:!1,error:!1,finished:!1}),v=f({currentPage:1,pageSize:10,total:-1}),T=async(t=!1)=>{const e={page:v.value.currentPage,limit:v.value.pageSize,user_id:m?m.user_id:-1};t&&(e.follow=!0);try{const o=await me(e),i=o.data.list.map(a=>({card_id:a.dynamic_post_id,userInfo:a.user_info,content:{desc:a.content,images:a.images},isFollow:a.isFollowed,isLike:a.isLiked,likeCount:a.like_count,commentCount:a.comment_count,createTime:a.created_at}));s.value.push(...i),v.value.total=o.data.totalCount,v.value.currentPage=o.data.currentPage,c.value.loading=!1,c.value.error=!1,c.value.finished=v.value.total<=s.value.length}catch(o){console.log(o),c.value.loading=!1,c.value.error=!0}},N=L.debounce(async()=>{_.value==="focusman"?(await T(!0),v.value.currentPage++):(await T(),v.value.currentPage++)},100),A=t=>{y.push(`/momentDetail/${t}`)},H=L.debounce(async t=>{const e={post_id:t,user_id:m==null?void 0:m.user_id};try{const o=await ve(e);s.value.forEach((i,a)=>{i.card_id===t&&(s.value[a].likeCount+=o.data,s.value[a].isLike=!s.value[a].isLike)}),h(o.msg)}catch{h("操作失败")}},200),R=L.debounce(async(t,e)=>{const o={follower_id:m==null?void 0:m.user_id,following_id:t,action:1};s.value.forEach((i,a)=>{i.card_id===e&&(s.value[a].isFollow?o.action=0:o.action=1)});try{const i=await X(o);s.value.forEach((a,p)=>{a.card_id===e&&(s.value[p].isFollow=!s.value[p].isFollow)}),h(i.msg)}catch(i){console.log(i),h("操作失败")}},200),C=Y({isShow:!1,shareOptions:de}),V=()=>{C.isShow=!0},S=f([]),F=f(!1),l=f({loading:!1,finished:!1,error:!1}),r=f({currentPage:1,pageSize:10,total:-1,post_id:-1}),j=()=>{l.value.loading=!1,l.value.finished=!1,l.value.error=!1,r.value.currentPage=1,r.value.pageSize=10,r.value.total=-1,r.value.post_id=-1},B=async()=>{const t={page:r.value.currentPage,limit:r.value.pageSize,post_id:r.value.post_id};try{let e=await fe(t);const o=e.data.list.map(i=>{const{comment_id:a,user_info:p,content:U,created_at:x}=i;return{comment_id:a,userInfo:p,content:U,createTime:x}});S.value.push(...o),r.value.total=e.data.totalCount,r.value.pageSize=e.data.pageSize,r.value.currentPage=e.data.currentPage,l.value.loading=!1,l.value.finished=S.value.length>=r.value.total}catch{l.value.error=!0,l.value.loading=!1}},G=L.debounce(async()=>{await B(),r.value.currentPage++},1e3),J=async t=>{F.value=!0,j(),r.value.post_id=t,S.value=[],await B()};return(t,e)=>{const o=ae,i=oe,a=te,p=re,U=ge,x=pe,K=le,q=se;return k(),z("main",_e,[d(ie,null,{left:g(()=>[P("div",he,[P("span",{class:O(`${_.value==="focusman"?"tabClass active":"tabClass mx-3"}`),onClick:e[0]||(e[0]=n=>b("focusman"))},"关注",2),P("span",{class:O(`${_.value==="worldman"?"tabClass active":"tabClass mx-3"}`),onClick:e[1]||(e[1]=n=>b("worldman"))},"世界",2)])]),right:g(()=>[P("div",we,[d(i,{"theme-vars":{searchPadding:0}},{default:g(()=>[d(o,{shape:"round",onFocus:e[2]||(e[2]=()=>w(y).push("/search"))})]),_:1})])]),_:1}),d(a,{height:"50px"}),d(x,{active:_.value,"onUpdate:active":e[5]||(e[5]=n=>_.value=n),animated:"","show-header":!1},{default:g(()=>[(k(),z($,null,E(M,n=>d(U,{key:n,name:n},{default:g(()=>[d(p,{loading:c.value.loading,"onUpdate:loading":e[3]||(e[3]=u=>c.value.loading=u),finished:c.value.finished,"finished-text":"没有更多了",error:c.value.error,"onUpdate:error":e[4]||(e[4]=u=>c.value.error=u),"error-text":"请求失败，点击重新加载",onLoad:w(N)},{default:g(()=>[(k(!0),z($,null,E(s.value,u=>(k(),ee(ce,{key:u.card_id,class:"my-2","moment-data":u,onClick:()=>A(u.card_id),onClickLike:()=>w(H)(u.card_id),onClickShare:V,onClickComment:()=>J(u.card_id),onClickFollow:()=>w(R)(u.userInfo.user_id,u.card_id)},null,8,["moment-data","onClick","onClickLike","onClickComment","onClickFollow"]))),128))]),_:1},8,["loading","finished","error","onLoad"])]),_:2},1032,["name"])),64))]),_:1},8,["active"]),d(K,{show:C.isShow,"onUpdate:show":e[6]||(e[6]=n=>C.isShow=n),title:"立即分享给好友",options:C.shareOptions},null,8,["show","options"]),d(q,{class:"h-96",show:F.value,"onUpdate:show":e[10]||(e[10]=n=>F.value=n),title:"评论"},{default:g(()=>[d(ue,{loading:l.value.loading,"onUpdate:loading":e[7]||(e[7]=n=>l.value.loading=n),finished:l.value.finished,"onUpdate:finished":e[8]||(e[8]=n=>l.value.finished=n),error:l.value.error,"onUpdate:error":e[9]||(e[9]=n=>l.value.error=n),"comment-list":S.value,"handle-comment-on-load":w(G)},null,8,["loading","finished","error","comment-list","handle-comment-on-load"])]),_:1},8,["show"])])}}}),Ve=ne(Ce,[["__scopeId","data-v-c3f6074e"]]);export{Ve as default};
