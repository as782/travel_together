import{a7 as G,aN as ee,aX as q,aY as ae,a1 as Z,O as te,aZ as j,d as H,r as _,A as ne,q as N,a_ as I,b as r,af as oe,ag as se,az as le,a$ as re,v as ue,G as ie,J as me,c as R,a as E,w as d,aT as de,b0 as ce,j as pe,s as L,o as O,g as F,D as ge,C as fe,B as ve,E as _e,u as $,F as he,ai as ye}from"./index-Al1ESLyH.js";import{C as Ve}from"./index-DJB-JNsy.js";/* empty css              *//* empty css              */import{p as J,P as De,a as be,R as xe,b as ke,A as we}from"./index.esm-DFUqB_kw.js";import{s as Ce,C as Ue}from"./index-CaizOAJJ.js";import"./index-xslAZJtX.js";import{u as Me,U as Fe}from"./index-Ci1VZxiM.js";import{S as Se}from"./index-B3c1HLcr.js";import{F as Pe}from"./index-Cb0lWyr4.js";import{I as Te}from"./index-o3mCI9mj.js";import{B as Ye}from"./index-dW7UAVpM.js";import"./index-BFdtbEqF.js";import"./function-call-CNCgHTtt.js";import"./index-uvLI7Ok2.js";const Ie=G({},J,{modelValue:ee(),filter:Function,formatter:{type:Function,default:(t,u)=>u}}),Oe=Object.keys(J);function Ae(t,u){if(t<0)return[];const m=Array(t);let o=-1;for(;++o<t;)m[o]=u(o);return m}const Be=(t,u)=>32-new Date(t,u-1,32).getDate(),A=(t,u,m,o,i,l)=>{const p=Ae(u-t+1,g=>{const h=q(t+g);return o(m,{text:h,value:h})});return i?i(m,p,l):p},je=(t,u)=>t.map((m,o)=>{const i=u[o];if(i.length){const l=+i[0].value,p=+i[i.length-1].value;return q(ae(+m,l,p))}return m}),Ne=Z(Ce),z=new Date().getFullYear(),[Re]=te("date-picker"),Ee=G({},Ie,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(z-10,0,1),validator:j},maxDate:{type:Date,default:()=>new Date(z+10,11,31),validator:j}});var Le=H({name:Re,props:Ee,emits:["confirm","cancel","change","update:modelValue"],setup(t,{emit:u,slots:m}){const o=_(t.modelValue),i=_(!1),l=()=>{const a=t.minDate.getFullYear(),n=t.maxDate.getFullYear();return A(a,n,"year",t.formatter,t.filter)},p=a=>a===t.minDate.getFullYear(),g=a=>a===t.maxDate.getFullYear(),h=a=>a===t.minDate.getMonth()+1,x=a=>a===t.maxDate.getMonth()+1,k=a=>{const{minDate:n,columnsType:e}=t,c=e.indexOf(a),f=i.value?t.modelValue[c]:o.value[c];if(f)return+f;switch(a){case"year":return n.getFullYear();case"month":return n.getMonth()+1;case"day":return n.getDate()}},y=()=>{const a=k("year"),n=p(a)?t.minDate.getMonth()+1:1,e=g(a)?t.maxDate.getMonth()+1:12;return A(n,e,"month",t.formatter,t.filter)},S=()=>{const a=k("year"),n=k("month"),e=p(a)&&h(n)?t.minDate.getDate():1,c=g(a)&&x(n)?t.maxDate.getDate():Be(a,n);return A(e,c,"day",t.formatter,t.filter)},V=ne(()=>t.columnsType.map(a=>{switch(a){case"year":return l();case"month":return y();case"day":return S();default:return[]}}));N(o,a=>{I(a,t.modelValue)||u("update:modelValue",a)}),N(()=>t.modelValue,(a,n)=>{i.value=I(n,o.value),a=je(a,V.value),I(a,o.value)||(o.value=a),i.value=!1},{immediate:!0});const w=(...a)=>u("change",...a),P=(...a)=>u("cancel",...a),T=(...a)=>u("confirm",...a);return()=>r(De,oe({modelValue:o.value,"onUpdate:modelValue":a=>o.value=a,columns:V.value,onChange:w,onCancel:P,onConfirm:T},se(t,Oe)),m)}});const $e=Z(Le),ze=le("tags",()=>{const t=_([]);function u(o){t.value=o}async function m(){try{const o=await re();o.data&&u(o.data.list)}catch(o){console.error("获取标签列表失败",o)}}return{tags:t,getTags:m,setTags:u}},{persist:!0}),Ge={class:"bg-transparent"},qe={class:"p-4"},ua=H({__name:"EditProfilePage",setup(t){var a;ue(()=>{u.tags.length===0&&u.getTags()});const u=ze(),m=u.tags,o=ie(),i=o.userInfo,l=me({...i,tags:(a=i==null?void 0:i.tags)==null?void 0:a.map(n=>n.tag_id)}),p=async()=>{const{user_id:n,avatar_url:e,nickname:c,gender:f,bio:D,birthday:v,tags:C,address:U,contact:M}=l,Y={user_id:n,avatar_url:V.value[0]||e,nickname:c,gender:f,bio:D,birthday:v,tags:C,region_name:U.name,region_code:U.code,contact_phone:M.phone,contact_email:M.email};try{const b=await ce(Y);o.refreshUserInfo(),b.code===200&&(pe.syncInfoToUserStore(),L({type:"success",message:b.msg,duration:1e3}))}catch(b){console.error(b),L({message:"更新失败",duration:1e3})}},g=_(!1),h={minData:new Date(1980,1,1),maxData:new Date},x=_(l.birthday.substring(0,10)),k=n=>{x.value=n.selectedValues.join("-");const e=new Date(n.selectedValues.join("-")).toISOString();l.birthday=e,g.value=!1},y=_(!1),S=n=>{y.value=!1,l.address.name=n.selectedOptions.map(e=>e.text).join("/"),l.address.code=n.selectedOptions.map(e=>e.value).join("/")},V=_([]),w=_([]),P=async n=>{var f;console.log("loadfile",n),n.status="uploading",n.message="上传中...";const e=((f=o==null?void 0:o.userInfo)==null?void 0:f.username)||"default",c=new FormData;c.append("avatar",n.file);try{let D=await Me(c,e);V.value=D.data.fileUrls,n.status="done",n.message="上传成功"}catch{n.status="failed",n.message="上传失败"}},T=()=>(V.value=[],!0);return(n,e)=>{const c=Te,f=Fe,D=Se,v=he,C=xe,U=ke,M=Ue,Y=Ne,b=$e,B=ye,K=we,X=Ve,Q=Ye,W=Pe;return O(),R("div",Ge,[E("div",{class:"flex justify-center items-center bg-fixed bg-cover",style:de({backgroundRepeat:"no-repeat",backgroundImage:"url("+l.avatar_url+")",height:"50vh"})},[r(D,{"offset-top":"80"},{default:d(()=>[r(f,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s),reupload:"","max-count":"1","after-read":P,"before-delete":T},{default:d(()=>[r(c,{round:"",class:"w-20 aspect-square",src:l.avatar_url},null,8,["src"])]),_:1},8,["modelValue"])]),_:1})],4),r(W,{class:"mt-4",onSubmit:p},{default:d(()=>[r(X,{inset:""},{default:d(()=>[r(v,{modelValue:l.nickname,"onUpdate:modelValue":e[1]||(e[1]=s=>l.nickname=s),name:"nickname",label:"昵称",placeholder:"请填写你的昵称","input-align":"right",class:"input"},null,8,["modelValue"]),r(v,{label:"性别",name:"gender",modelValue:l.gender,"onUpdate:modelValue":e[3]||(e[3]=s=>l.gender=s),class:"input","input-align":"right"},{input:d(()=>[r(U,{modelValue:l.gender,"onUpdate:modelValue":e[2]||(e[2]=s=>l.gender=s),direction:"horizontal"},{default:d(()=>[r(C,{name:"male"},{default:d(()=>[F("男")]),_:1}),r(C,{name:"female"},{default:d(()=>[F("女")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),r(v,{modelValue:l.bio,"onUpdate:modelValue":e[4]||(e[4]=s=>l.bio=s),name:"bio",label:"签名","input-align":"right",placeholder:"说点什么再出发吧",class:"input"},null,8,["modelValue"]),r(v,{label:"标签",name:"tags",class:"input",placeholder:"请选择标签"},{input:d(()=>[r(Y,{modelValue:l.tags,"onUpdate:modelValue":e[5]||(e[5]=s=>l.tags=s),direction:"horizontal"},{default:d(()=>[(O(!0),R(ge,null,fe($(m),s=>(O(),ve(M,{class:"m-2",key:s.tag_id,name:s.tag_id},{default:d(()=>[F(_e(s.tag_name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(v,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=s=>x.value=s),"is-link":"",readonly:"",name:"birthday",label:"生日",placeholder:"点击选择日期",onClick:e[7]||(e[7]=s=>g.value=!0)},null,8,["modelValue"]),r(B,{show:g.value,"onUpdate:show":e[8]||(e[8]=s=>g.value=s),position:"bottom"},{default:d(()=>[r(b,{onConfirm:k,title:"选择日期","min-date":h.minData,"max-date":h.maxData},null,8,["min-date","max-date"])]),_:1},8,["show"]),r(v,{modelValue:l.address.name,"onUpdate:modelValue":e[9]||(e[9]=s=>l.address.name=s),"is-link":"",readonly:"",name:"addressName",label:"地区选择",placeholder:"点击选择省市区",onClick:e[10]||(e[10]=s=>y.value=!0)},null,8,["modelValue"]),r(B,{show:y.value,"onUpdate:show":e[12]||(e[12]=s=>y.value=s),position:"bottom"},{default:d(()=>[r(K,{"area-list":$(be),onConfirm:S,onCancel:e[11]||(e[11]=s=>y.value=!1)},null,8,["area-list"])]),_:1},8,["show"]),r(v,{modelValue:l.contact.phone,"onUpdate:modelValue":e[13]||(e[13]=s=>l.contact.phone=s),name:"phone",label:"电话","input-align":"right",placeholder:"为你推荐喜欢的旅行",class:"input"},null,8,["modelValue"])]),_:1}),E("div",qe,[r(Q,{block:"",type:"primary","native-type":"submit",class:"btn"},{default:d(()=>[F(" 保存 ")]),_:1})])]),_:1})])}}});export{ua as default};
