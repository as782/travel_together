import{O as K,d as Q,J as ee,bm as re,r as Z,A as E,q as R,T as me,U as oe,b as v,b5 as M,a9 as j,bn as B,aY as y,$ as ue,aV as ve,Y as ae,bt as ge,v as de,b9 as fe,bi as he,t as we,af as te,ag as Ce,ai as Ie,ac as x,aN as Pe,X as $,aa as F,ab as V,aU as Se,I as be,an as ye,ao as xe,a7 as Oe,ap as Te,aq as Ye}from"./index-Al1ESLyH.js";import{S as ke,a as Xe}from"./index-uvLI7Ok2.js";import{I as Ze}from"./index-o3mCI9mj.js";const G=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Re=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),A=K("image-preview")[1],J=2.6,ze={src:String,show:Boolean,active:Number,minZoom:M(j),maxZoom:M(j),rootWidth:M(Number),rootHeight:M(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean};var De=Q({props:ze,emits:["scale","close","longPress"],setup(e,{emit:c,slots:g}){const o=ee({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=re(),n=Z(),I=Z(),O=Z(!1),f=Z(!1);let T=0;const z=E(()=>{const{scale:a,moveX:t,moveY:i,moving:l,zooming:m,initializing:C}=o,H={transitionDuration:m||l||C?"0s":".3s"};return(a!==1||f.value)&&(H.transform=`matrix(${a}, 0, 0, ${a}, ${t}, ${i})`),H}),d=E(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:t}=e,i=O.value?t/o.imageRatio:a;return Math.max(0,(o.scale*i-a)/2)}return 0}),w=E(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:t}=e,i=O.value?t:a*o.imageRatio;return Math.max(0,(o.scale*i-t)/2)}return 0}),Y=(a,t)=>{var i;if(a=y(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const l=a/o.scale;if(o.scale=a,t){const m=ae((i=n.value)==null?void 0:i.$el),C={x:m.width*.5,y:m.height*.5},H=o.moveX-(t.x-m.left-C.x)*(l-1),ce=o.moveY-(t.y-m.top-C.y)*(l-1);o.moveX=y(H,-d.value,d.value),o.moveY=y(ce,-w.value,w.value)}else o.moveX=0,o.moveY=f.value?T:0;c("scale",{scale:a,index:e.active})}},P=()=>{Y(1)},W=()=>{const a=o.scale>1?1:2;Y(a,a===2||f.value?{x:r.startX.value,y:r.startY.value}:void 0)};let S,k,b,s,h,u,D,L,_=!1;const ie=a=>{const{touches:t}=a;if(S=t.length,S===2&&e.disableZoom)return;const{offsetX:i}=r;r.start(a),k=o.moveX,b=o.moveY,L=Date.now(),_=!1,o.moving=S===1&&(o.scale!==1||f.value),o.zooming=S===2&&!i.value,o.zooming&&(s=o.scale,h=G(t))},se=a=>{const{touches:t}=a;if(r.move(a),o.moving){const{deltaX:i,deltaY:l}=r,m=i.value+k,C=l.value+b;if((m>d.value||m<-d.value)&&!_&&r.isHorizontal()){o.moving=!1;return}_=!0,B(a,!0),o.moveX=y(m,-d.value,d.value),o.moveY=y(C,-w.value,w.value)}if(o.zooming&&(B(a,!0),t.length===2)){const i=G(t),l=s*i/h;u=Re(t),Y(l,u)}},p=a=>{var t;const i=(t=I.value)==null?void 0:t.$el,l=i.firstElementChild,m=a.target===i,C=l==null?void 0:l.contains(a.target);!e.closeOnClickImage&&C||!e.closeOnClickOverlay&&m||c("close")},ne=a=>{if(S>1)return;const t=Date.now()-L,i=250;r.isTap.value&&(t<i?e.doubleScale?D?(clearTimeout(D),D=null,W()):D=setTimeout(()=>{p(a),D=null},i):p(a):t>ge&&c("longPress"))},q=a=>{let t=!1;if((o.moving||o.zooming)&&(t=!0,o.moving&&k===o.moveX&&b===o.moveY&&(t=!1),!a.touches.length)){o.zooming&&(o.moveX=y(o.moveX,-d.value,d.value),o.moveY=y(o.moveY,-w.value,w.value),o.zooming=!1),o.moving=!1,k=0,b=0,s=1,o.scale<1&&P();const i=+e.maxZoom;o.scale>i&&Y(i,u)}B(a,t),ne(a),r.reset()},U=()=>{const{rootWidth:a,rootHeight:t}=e,i=t/a,{imageRatio:l}=o;O.value=o.imageRatio>i&&l<J,f.value=o.imageRatio>i&&l>=J,f.value&&(T=(l*a-t)/2,o.moveY=T,o.initializing=!0,ue(()=>{o.initializing=!1})),P()},le=a=>{const{naturalWidth:t,naturalHeight:i}=a.target;o.imageRatio=i/t,U()};return R(()=>e.active,P),R(()=>e.show,a=>{a||P()}),R(()=>[e.rootWidth,e.rootHeight],U),me("touchmove",se,{target:E(()=>{var a;return(a=I.value)==null?void 0:a.$el})}),oe({resetScale:P}),()=>{const a={loading:()=>v(ve,{type:"spinner"},null)};return v(ke,{ref:I,class:A("swipe-item"),onTouchstartPassive:ie,onTouchend:q,onTouchcancel:q},{default:()=>[g.image?v("div",{class:A("image-wrap")},[g.image({src:e.src})]):v(Ze,{ref:n,src:e.src,fit:"contain",class:A("image",{vertical:O.value}),style:z.value,onLoad:le},a)]})}}});const[He,X]=K("image-preview"),Ee=["show","teleport","transition","overlayStyle","closeOnPopstate"],Me={show:Boolean,loop:x,images:Pe(),minZoom:$(1/3),maxZoom:$(3),overlay:x,closeable:Boolean,showIndex:x,className:F,closeIcon:V("clear"),transition:String,beforeClose:Function,doubleScale:x,overlayClass:F,overlayStyle:Object,swipeDuration:$(300),startPosition:$(0),showIndicators:Boolean,closeOnPopstate:x,closeOnClickImage:x,closeOnClickOverlay:x,closeIconPosition:V("top-right"),teleport:[String,Object]};var $e=Q({name:He,props:Me,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:g}){const o=Z(),r=Z(),n=ee({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),I=()=>{if(o.value){const s=ae(o.value.$el);n.rootWidth=s.width,n.rootHeight=s.height,o.value.resize()}},O=s=>c("scale",s),f=s=>c("update:show",s),T=()=>{ye(e.beforeClose,{args:[n.active],done:()=>f(!1)})},z=s=>{s!==n.active&&(n.active=s,c("change",s))},d=()=>{if(e.showIndex)return v("div",{class:X("index")},[g.index?g.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},w=()=>{if(g.cover)return v("div",{class:X("cover")},[g.cover()])},Y=()=>{n.disableZoom=!0},P=()=>{n.disableZoom=!1},W=()=>v(Xe,{ref:o,lazyRender:!0,loop:e.loop,class:X("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:z,onDragEnd:P,onDragStart:Y},{default:()=>[e.images.map((s,h)=>v(De,{ref:u=>{h===n.active&&(r.value=u)},src:s,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,onScale:O,onClose:T,onLongPress:()=>c("longPress",{index:h})},{image:g.image}))]}),S=()=>{if(e.closeable)return v(be,{role:"button",name:e.closeIcon,class:[X("close-icon",e.closeIconPosition),Se],onClick:T},null)},k=()=>c("closed"),b=(s,h)=>{var u;return(u=o.value)==null?void 0:u.swipeTo(s,h)};return oe({resetScale:()=>{var s;(s=r.value)==null||s.resetScale()},swipeTo:b}),de(I),R([fe,he],I),R(()=>e.startPosition,s=>z(+s)),R(()=>e.show,s=>{const{images:h,startPosition:u}=e;s?(z(+u),we(()=>{I(),b(+u,{immediate:!0})})):c("close",{index:n.active,url:h[n.active]})}),()=>v(Ie,te({class:[X(),e.className],overlayClass:[X("overlay"),e.overlayClass],onClosed:k,"onUpdate:show":f},Ce(e,Ee)),{default:()=>[S(),W(),d(),w()]})}});let N;const Ne={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function We(){({instance:N}=Te({setup(){const{state:e,toggle:c}=Ye(),g=()=>{e.images=[]};return()=>v($e,te(e,{onClosed:g,"onUpdate:show":c}),null)}}))}const Le=(e,c=0)=>{if(xe)return N||We(),e=Array.isArray(e)?{images:e,startPosition:c}:e,N.open(Oe({},Ne,e)),N};export{$e as a,Le as s};
