import{d as ye,G as we,r as d,A as be,J as Y,v as Z,s as g,c as f,b as n,w as y,aA as ke,aB as Ie,L as Ce,f as Se,o as c,a as t,D as U,C as P,B as j,E as r,g as ee,u as te,V as Te,ar as Be,aC as Ue,I as Pe,M as je}from"./index-Al1ESLyH.js";import{p as ze,A as Ae}from"./index-ByBQl65H.js";import{T as De}from"./index-BPo13gx-.js";import{S as Le}from"./index-D0XsUnBT.js";import{_ as qe}from"./CommentPlane.vue_vue_type_script_setup_true_lang-wUZzw904.js";import{S as Oe}from"./index-BKOHJvEI.js";import{i as $e,b as Ne,j as Ve}from"./index-Bc0MyXRq.js";import{l as Ee}from"./lodash-TVC-EY0t.js";import{s as Ge}from"./function-call-CNCgHTtt.js";import"./index-BFdtbEqF.js";import{A as Me}from"./index-BVAKaSy2.js";import{A as Je}from"./index-DEValKwa.js";import{S as Re,a as He}from"./index-uvLI7Ok2.js";import{I as Fe}from"./index-o3mCI9mj.js";import{B as Ke}from"./index-dW7UAVpM.js";import"./index-DVp0JOWu.js";import"./use-tab-status-CfkwxFsA.js";import"./tool-DO7ubHTV.js";const Qe={class:"bg-blue-100"},We={class:"fixed z-50 top-0 w-full h-10 py-2"},Xe={class:"flex justify-between"},Ye={class:"bg-gray-600 bg-opacity-20 m-2 rounded-full w-12 aspect-square flex items-center justify-center"},Ze={class:"bg-gray-600 bg-opacity-20 m-2 rounded-full w-12 aspect-square flex items-center justify-center"},et=["src"],tt={class:"desc p-2 bg-white"},st={class:"text-sm font-bold"},ot={style:{"font-size":"12px"}},at={class:"condition flex flex-col my-2"},nt={class:"destination"},lt={class:"ml-1 text-gray-400",style:{"font-size":"12px"}},rt={class:"time"},it={class:"ml-1 text-gray-400",style:{"font-size":"12px"}},ct={class:"flex justify-around w-full my-2"},dt={class:"flex flex-col justify-center items-center"},ut=t("h4",{class:"text-xs"},"小队人数",-1),_t={class:"text-sm text-blue-400 font-bold"},mt={class:"flex flex-col justify-center items-center"},ft=t("h4",{class:"text-xs"},"预计消费",-1),pt={class:"text-sm text-blue-400 font-bold"},ht={class:"flex flex-col justify-center items-center"},vt=t("h4",{class:"text-xs"},"性别要求",-1),xt={class:"text-sm text-blue-400 font-bold"},gt={class:"flex flex-col justify-center items-center"},yt=t("h4",{class:"text-xs"},"付费方式",-1),wt={class:"text-sm text-blue-400 font-bold"},bt={class:"w-full p-2 my-3 bg-white"},kt=t("h4",{class:"text-gray-500"},"我们的队长",-1),It={class:"avator flex items-center w-11/12 h-14 mx-auto shadow-md shadow-gray-300 rounded-3xl"},Ct={class:"flex flex-1 flex-col"},St={class:"w-3/5 h-full mx-1 my-1 truncate text-sm text-nowrap text-gray-500 font-bold"},Tt={class:"flex justify-start"},Bt={class:"p-2 bg-white"},Ut=t("h4",{class:"text-gray-500"},"已参加的伙伴",-1),Pt={class:"w-full my-2"},jt=["data-user_id"],zt=["src","data-user_id"],At=["data-user_id"],Dt={class:"plan w-full p-2 mt-3 bg-white"},Lt=t("h4",{class:"text-gray-500"},"行程安排",-1),qt={class:"img-content"},Ot=["src"],$t={key:1,class:"w-full mx-auto"},Nt={class:"w-full p-2 mt-3 bg-white"},Vt={class:"text-gray-500 m-2"},Et={class:"active-comment flex justify-center items-center"},Gt={key:0,class:"flex flex-1"},is=ye({__name:"GroupDetailPage",setup(Mt){const I=Se(),se=ke(),w=Number(se.params.id),u=we(),p=d(),z=d(),oe=async s=>{try{let e=await Ie(s);z.value=e.data.tags}catch(e){console.error(e)}},ae=be(()=>{var s,e;return((s=u.userInfo)==null?void 0:s.user_id)===((e=p.value)==null?void 0:e.user_id)}),k=Y({isShow:!1,shareOptions:Oe}),ne=()=>{I.back()},le=()=>{k.isShow=!0},l=d();Z(()=>{re(w).then(()=>{var s;oe((s=p.value)==null?void 0:s.user_id)})});const re=async s=>{var e,a;try{const i=await $e(s);l.value=i.data,p.value=i.data.user_info,S.value=(e=i.data.like_userIds)==null?void 0:e.length,T.value=(a=i.data.like_userIds)==null?void 0:a.some(m=>{var h;return m===((h=u.userInfo)==null?void 0:h.user_id)}),C.value=i.data.images.map(m=>({id:m.image_id,imgUrl:m.image_url}))}catch(i){console.error(i)}},C=d([]),ie=s=>{Ge({images:C.value.map(e=>e.imgUrl),startPosition:s})},A=d([]);Z(()=>{ce(w)});const ce=async s=>{try{const e=await Ne(s);A.value=e.data}catch(e){console.error(e)}},D=s=>{var e;if(s===((e=u.userInfo)==null?void 0:e.user_id)){I.push({path:"/mine"});return}I.push({path:`/user/${s}`})},de=s=>{const e=s.target.getAttribute("data-user_id");D(e)},_=Y({loading:!1,finished:!1,error:!1}),b=d([]),ue=()=>{setTimeout(()=>{var s,e;b.value=((e=(s=l.value)==null?void 0:s.comments)==null?void 0:e.map(a=>({comment_id:a.comment_id,content:a.content,createTime:a.created_at,userInfo:a.user_info})).reverse())||[],_.loading=!1,_.finished=!0},1e3)},v=d(),_e=async()=>{var s;if(!v.value){g("大哥，说点啥再评论吧！");return}try{const e=v.value,i={user_id:(s=u.userInfo)==null?void 0:s.user_id,post_id:w,content:e},m=await ze(i);g(m.msg);const h=new Date;b.value.unshift({comment_id:h.getTime(),content:v.value,createTime:h.toISOString(),userInfo:u.userInfo}),v.value=""}catch(e){console.error(e)}},S=d(),T=d(),me=Ee.debounce(async()=>{var e;const s={post_id:w,user_id:(e=u.userInfo)==null?void 0:e.user_id};try{const a=await Ve(s);S.value+=a.data,T.value=a.data>0,g(a.msg)}catch{g("操作失败")}},200),fe=async()=>{var s;try{const e={user_id:(s=u.userInfo)==null?void 0:s.user_id,post_id:w};await Ue(e),g("加入成功")}catch(e){console.error(e),g("加入失败")}};return(s,e)=>{const a=Pe,i=Le,m=Re,h=He,L=Fe,pe=De,he=Ke,ve=je,q=Ae,B=Me,xe=Je,ge=Ce;return c(),f("main",Qe,[n(ge,null,{default:y(()=>{var O,$,N,V,E,G,M,J,R,H,F,K,Q,W,X;return[t("div",We,[t("div",Xe,[t("div",Ye,[n(a,{onClick:ne,class:"mx-2",color:"#fff",name:"arrow-left",size:"30"})]),t("div",Ze,[n(a,{onClick:le,class:"mx-2",color:"#fff",name:"share",size:"30"})])]),n(i,{show:k.isShow,"onUpdate:show":e[0]||(e[0]=o=>k.isShow=o),title:"立即分享给好友",options:k.shareOptions},null,8,["show","options"])]),n(h,{autoplay:3e3,"lazy-render":""},{default:y(()=>[(c(!0),f(U,null,P(C.value,(o,x)=>(c(),j(m,{class:"h-96",onClick:()=>ie(x),key:o.id},{default:y(()=>[t("img",{src:o.imgUrl,class:"w-96 h-96 object-cover"},null,8,et)]),_:2},1032,["onClick"]))),128))]),_:1}),t("div",tt,[t("h4",st,r((O=l.value)==null?void 0:O.title),1),t("p",ot,r(($=l.value)==null?void 0:$.description),1),t("div",at,[t("div",nt,[n(a,{color:"#9d9dff",name:"location"}),t("span",lt,r((N=l.value)==null?void 0:N.start_location)+" - "+r((V=l.value)==null?void 0:V.end_location),1)]),t("div",rt,[n(a,{color:"#9d9dff",name:"clock"}),t("span",it,r((E=l.value)==null?void 0:E.duration_day)+"天 ",1)])]),t("div",ct,[t("div",dt,[ut,t("span",_t,r((G=l.value)==null?void 0:G.team_size)+"人",1)]),t("div",mt,[ft,t("span",pt,r((M=l.value)==null?void 0:M.estimated_expense)+"元",1)]),t("div",ht,[vt,t("span",xt,r(((J=l.value)==null?void 0:J.gender_requirement)=="male"?"男":((R=l.value)==null?void 0:R.gender_requirement)=="female"?"女":"不限"),1)]),t("div",gt,[yt,t("span",wt,r((H=l.value)==null?void 0:H.payment_method),1)])])]),t("div",bt,[kt,t("div",It,[n(L,{round:"",class:"w-8 flex-none aspect-square mx-2",src:(F=p.value)==null?void 0:F.avatar_url},null,8,["src"]),t("div",Ct,[t("span",St,r((K=p.value)==null?void 0:K.nickname),1),t("div",Tt,[(c(!0),f(U,null,P(z.value,(o,x)=>(c(),j(pe,{class:"mr-2",key:o,round:"",type:x%2?"primary":"success"},{default:y(()=>[ee(r(o.tag_name),1)]),_:2},1032,["type"]))),128))])]),n(a,{class:"flex-none mr-2",color:"#9d9dff",name:"arrow",onClick:e[1]||(e[1]=()=>{var o;return D((o=p.value)==null?void 0:o.user_id)}),size:"30"})])]),t("div",Bt,[Ut,t("div",Pt,[t("ul",{class:"flex p-1 overflow-x-auto",onClick:de},[(c(!0),f(U,null,P(A.value,o=>(c(),f("div",{key:o.user_id,class:"flex flex-col mx-1 justify-center items-center","data-user_id":o.user_id},[t("img",{class:"w-8 aspect-square mx-2 rounded-full",src:o.avatar_url,"data-user_id":o.user_id},null,8,zt),t("span",{class:"mt-1 text-xs text-gray-500","data-user_id":o.user_id},r(o.nickname),9,At)],8,jt))),128))])])]),t("div",Dt,[Lt,t("div",qt,[(Q=l.value)!=null&&Q.itinerary?(c(),f("img",{key:0,src:(W=l.value)==null?void 0:W.itinerary,alt:"行程安排"},null,8,Ot)):(c(),f("span",$t,"没有行程安排"))])]),t("div",Nt,[t("h4",Vt,"评论 "+r(b.value.length)+" 条",1),t("div",Et,[n(L,{round:"",class:"flex-none w-10 aspect-square mx-2",src:(X=te(u).userInfo)==null?void 0:X.avatar_url},null,8,["src"]),Te(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),class:"flex-1 rounded-2xl p-1 px-2 mx-2 border border-blue-300 placeholder:text-xs",placeholder:"发表一下你的看法"},null,512),[[Be,v.value]]),n(he,{type:"primary",size:"small",onClick:_e},{default:y(()=>[ee("发送")]),_:1})]),n(qe,{loading:_.loading,"onUpdate:loading":e[3]||(e[3]=o=>_.loading=o),finished:_.finished,"onUpdate:finished":e[4]||(e[4]=o=>_.finished=o),error:_.error,"onUpdate:error":e[5]||(e[5]=o=>_.error=o),"comment-list":b.value,"handle-comment-on-load":ue},null,8,["loading","finished","error","comment-list"])]),n(ve,{width:"100%",height:"50px"}),n(xe,null,{default:y(()=>{var o,x;return[n(q,{icon:T.value?"like":"like-o",color:"#1989fa",text:`${S.value}`,onClick:te(me)},null,8,["icon","text","onClick"]),n(q,{icon:"chat-o",text:`${b.value.length}`},null,8,["text"]),ae.value?(c(),j(B,{key:1,color:"#9d9dff",type:"danger",to:`/publishgroup/${(x=l.value)==null?void 0:x.post_id}`,text:"去编辑"},null,8,["to"])):(c(),f("div",Gt,[n(B,{color:"#be99ff",type:"warning",to:`/chat/${(o=p.value)==null?void 0:o.user_id}`,text:"联系队长"},null,8,["to"]),n(B,{color:"#7232dd",type:"danger",onClick:fe,text:"立即加入"})]))]}),_:1})]}),_:1})])}}});export{is as default};
