import{v as oe,t as be,as as Se,at as Le,u as h,au as ae,A as $,r as L,av as Pe,q as Z,d as Te,a5 as xe,G as Re,s as U,H as $e,J as ze,c as M,b as P,w as z,N as Oe,f as De,o as T,a as x,g as A,E as te,B as E,a3 as q,aw as J,ax as K,D as X,C as Y,af as j,M as Ve}from"./index-Al1ESLyH.js";import{A as Be}from"./index-Crpe8AyD.js";import{_ as Me}from"./CommentPlane.vue_vue_type_script_setup_true_lang-wUZzw904.js";import{S as Ee}from"./index-D0XsUnBT.js";/* empty css              *//* empty css              */import{E as He}from"./index-C4YkaPVR.js";import{_ as Fe}from"./GroupInfoCard.vue_vue_type_script_setup_true_lang-Dbxb_lqa.js";import{_ as Ue}from"./MomentsActivityCard.vue_vue_type_script_setup_true_lang-DQiuus_c.js";import{l as I}from"./lodash-TVC-EY0t.js";import{_ as Ge}from"./UserCard.vue_vue_type_script_setup_true_lang-Dg6dNw8w.js";import{u as Ne}from"./search-l6njEG29.js";import{l as We,d as Ae}from"./index-Bc0MyXRq.js";import{S as qe}from"./index-BKOHJvEI.js";import{a as Je,T as Ke}from"./index-CAMe5tuU.js";import"./index-DVp0JOWu.js";import"./use-tab-status-CfkwxFsA.js";import"./tool-DO7ubHTV.js";import"./index-o3mCI9mj.js";import"./index-BXtSv6Ia.js";import"./index-dW7UAVpM.js";import"./index-uvLI7Ok2.js";import"./index-B3c1HLcr.js";function Xe(e){return Se()?(Le(e),!0):!1}function Ye(e){return typeof e=="function"?e():h(e)}const je=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;function Ie(e){return e||ae()}function Qe(e,t=!0,o){Ie()?oe(e,o):t?e():be(e)}function O(e){var t;const o=Ye(e);return(t=o==null?void 0:o.$el)!=null?t:o}const ne=je?window:void 0;function Ze(){const e=L(!1),t=ae();return t&&oe(()=>{e.value=!0},t),e}function et(e){const t=Ze();return $(()=>(t.value,!!e()))}function tt(e,t,o={}){const{window:r=ne,...n}=o;let a;const c=et(()=>r&&"ResizeObserver"in r),s=()=>{a&&(a.disconnect(),a=void 0)},p=$(()=>Array.isArray(e)?e.map(i=>O(i)):[O(e)]),f=Z(p,i=>{if(s(),c.value&&r){a=new ResizeObserver(t);for(const d of i)d&&a.observe(d,n)}},{immediate:!0,flush:"post"}),C=()=>{s(),f()};return Xe(C),{isSupported:c,stop:C}}function ot(e,t={width:0,height:0},o={}){const{window:r=ne,box:n="content-box"}=o,a=$(()=>{var i,d;return(d=(i=O(e))==null?void 0:i.namespaceURI)==null?void 0:d.includes("svg")}),c=L(t.width),s=L(t.height),{stop:p}=tt(e,([i])=>{const d=n==="border-box"?i.borderBoxSize:n==="content-box"?i.contentBoxSize:i.devicePixelContentBoxSize;if(r&&a.value){const v=O(e);if(v){const g=r.getComputedStyle(v);c.value=Number.parseFloat(g.width),s.value=Number.parseFloat(g.height)}}else if(d){const v=Array.isArray(d)?d:[d];c.value=v.reduce((g,{inlineSize:k})=>g+k,0),s.value=v.reduce((g,{blockSize:k})=>g+k,0)}else c.value=i.contentRect.width,s.value=i.contentRect.height},o);Qe(()=>{const i=O(e);i&&(c.value="offsetWidth"in i?i.offsetWidth:t.width,s.value="offsetHeight"in i?i.offsetHeight:t.height)});const f=Z(()=>O(e),i=>{c.value=i?t.width:0,s.value=i?t.height:0});function C(){p(),f()}return{width:c,height:s,stop:C}}function Q(e,t){const{containerStyle:o,wrapperProps:r,scrollTo:n,calculateRange:a,currentList:c,containerRef:s}="itemHeight"in t?st(t,e):nt(t,e);return{list:c,scrollTo:n,containerProps:{ref:s,onScroll:()=>{a()},style:o},wrapperProps:r}}function se(e){const t=L(null),o=ot(t),r=L([]),n=Pe(e);return{state:L({start:0,end:10}),source:n,currentList:r,size:o,containerRef:t}}function re(e,t,o){return r=>{if(typeof o=="number")return Math.ceil(r/o);const{start:n=0}=e.value;let a=0,c=0;for(let s=n;s<t.value.length;s++){const p=o(s);if(a+=p,c=s,a>r)break}return c-n}}function ie(e,t){return o=>{if(typeof t=="number")return Math.floor(o/t)+1;let r=0,n=0;for(let a=0;a<e.value.length;a++){const c=t(a);if(r+=c,r>=o){n=a;break}}return n+1}}function le(e,t,o,r,{containerRef:n,state:a,currentList:c,source:s}){return()=>{const p=n.value;if(p){const f=o(e==="vertical"?p.scrollTop:p.scrollLeft),C=r(e==="vertical"?p.clientHeight:p.clientWidth),i=f-t,d=f+C+t;a.value={start:i<0?0:i,end:d>s.value.length?s.value.length:d},c.value=s.value.slice(a.value.start,a.value.end).map((v,g)=>({data:v,index:g+a.value.start}))}}}function ce(e,t){return o=>typeof e=="number"?o*e:t.value.slice(0,o).reduce((n,a,c)=>n+e(c),0)}function ue(e,t,o){Z([e.width,e.height,t],()=>{o()})}function de(e,t){return $(()=>typeof e=="number"?t.value.length*e:t.value.reduce((o,r,n)=>o+e(n),0))}const at={horizontal:"scrollLeft",vertical:"scrollTop"};function fe(e,t,o,r){return n=>{r.value&&(r.value[at[e]]=o(n),t())}}function nt(e,t){const o=se(t),{state:r,source:n,currentList:a,size:c,containerRef:s}=o,p={overflowX:"auto"},{itemWidth:f,overscan:C=5}=e,i=re(r,n,f),d=ie(n,f),v=le("horizontal",C,d,i,o),g=ce(f,n),k=$(()=>g(r.value.start)),D=de(f,n);ue(c,t,v);const V=fe("horizontal",v,g,s),B=$(()=>({style:{height:"100%",width:`${D.value-k.value}px`,marginLeft:`${k.value}px`,display:"flex"}}));return{scrollTo:V,calculateRange:v,wrapperProps:B,containerStyle:p,currentList:a,containerRef:s}}function st(e,t){const o=se(t),{state:r,source:n,currentList:a,size:c,containerRef:s}=o,p={overflowY:"auto"},{itemHeight:f,overscan:C=5}=e,i=re(r,n,f),d=ie(n,f),v=le("vertical",C,d,i,o),g=ce(f,n),k=$(()=>g(r.value.start)),D=de(f,n);ue(c,t,v);const V=fe("vertical",v,g,s),B=$(()=>({style:{width:"100%",height:`${D.value-k.value}px`,marginTop:`${k.value}px`}}));return{calculateRange:v,scrollTo:V,containerStyle:p,wrapperProps:B,currentList:a,containerRef:s}}const rt={class:"bg-white p-1 h-screen"},it={class:"text-sm"},lt={class:"text-blue-300"},Ot=Te({__name:"SearchResultPage",setup(e){const t=De(),o=Ne(),{groupCardDataList:r,userCardDataList:n,momentCardDataList:a}=xe(o),c=Re(),{userInfo:s}=c,p=L("a"),{list:f,containerProps:C,wrapperProps:i}=Q(r,{itemHeight:300,overscan:2}),{list:d,containerProps:v,wrapperProps:g}=Q(n,{itemHeight:100,overscan:2}),{list:k,containerProps:D,wrapperProps:V}=Q(a,{itemHeight:400,overscan:2}),B=m=>{t.push(`/groupDetail/${m}`)},pe=m=>{t.push(`/momentDetail/${m}`)},ve=I.debounce(async m=>{const u={post_id:m,user_id:s==null?void 0:s.user_id};try{const b=await We(u);a.value.forEach((S,y)=>{S.card_id===m&&(a.value[y].likeCount+=b.data,a.value[y].isLike=!a.value[y].isLike)}),U(b.msg)}catch{U("操作失败")}},200),me=I.debounce(async(m,u)=>{const b={follower_id:s==null?void 0:s.user_id,following_id:m,action:1};a.value.forEach((S,y)=>{S.card_id===u&&(a.value[y].isFollow?b.action=0:b.action=1)});try{const S=await $e(b);a.value.forEach((y,R)=>{y.card_id===u&&(a.value[R].isFollow=!a.value[R].isFollow)}),U(S.msg)}catch(S){console.log(S),U("操作失败")}},200),H=ze({isShow:!1,shareOptions:qe}),he=()=>{H.isShow=!0},F=L([]),G=L(!1),_=L({loading:!1,finished:!1,error:!1}),w=L({currentPage:1,pageSize:10,total:-1,post_id:-1}),ge=()=>{_.value.loading=!1,_.value.finished=!1,_.value.error=!1,w.value.currentPage=1,w.value.pageSize=10,w.value.total=-1,w.value.post_id=-1},ee=async()=>{const m={page:w.value.currentPage,limit:w.value.pageSize,post_id:w.value.post_id};try{let u=await Ae(m);const b=u.data.list.map(S=>{const{comment_id:y,user_info:R,content:N,created_at:W}=S;return{comment_id:y,userInfo:R,content:N,createTime:W}});F.value.push(...b),w.value.total=u.data.totalCount,w.value.pageSize=u.data.pageSize,w.value.currentPage=u.data.currentPage,_.value.loading=!1,_.value.finished=F.value.length>=w.value.total}catch{_.value.error=!0,_.value.loading=!1}},_e=I.debounce(async()=>{await ee(),w.value.currentPage++},1e3),we=async m=>{G.value=!0,ge(),w.value.post_id=m,F.value=[],await ee()};return(m,u)=>{const b=Oe,S=Ve,y=He,R=Ke,N=Je,W=Ee,ye=Me,Ce=Be;return T(),M("main",rt,[P(b,{fixed:"","z-index":999,"left-arrow":"",onClickLeft:u[0]||(u[0]=l=>m.$router.back())},{title:z(()=>[x("h4",it,[A(" 关于： "),x("span",null,te(m.$route.query.key?m.$route.query.key:"空"),1),A(" 共 "),x("em",lt,te(h(o).dataConunt),1),A(" 条结果 ")])]),_:1}),P(S,{height:"50px"}),P(N,{active:p.value,"onUpdate:active":u[1]||(u[1]=l=>p.value=l),animated:"",sticky:""},{default:z(()=>[P(R,{title:"组队",name:"a"},{default:z(()=>[h(f).length?q("",!0):(T(),E(y,{key:0,description:"没有更多了"})),x("div",j(h(C),{style:{height:"100vh"}}),[x("div",J(K(h(i))),[(T(!0),M(X,null,Y(h(f),l=>(T(),E(Fe,{key:l.data.card_id,onClick:ke=>B(l.data.card_id),cardData:l.data,class:"m-2"},null,8,["onClick","cardData"]))),128))],16)],16)]),_:1}),P(R,{title:"动态",name:"b"},{default:z(()=>[h(k).length?q("",!0):(T(),E(y,{key:0,description:"没有更多了"})),x("div",j(h(D),{style:{height:"100vh"}}),[x("div",J(K(h(V))),[(T(!0),M(X,null,Y(h(k),l=>(T(),E(Ue,{key:l.card_id,class:"my-2","moment-data":l.data,onClick:()=>pe(l.data.card_id),onClickLike:()=>h(ve)(l.data.card_id),onClickShare:he,onClickComment:()=>we(l.data.card_id),onClickFollow:()=>h(me)(l.data.userInfo.user_id,l.data.card_id)},null,8,["moment-data","onClick","onClickLike","onClickComment","onClickFollow"]))),128))],16)],16)]),_:1}),P(R,{title:"用户",name:"c"},{default:z(()=>[h(d).length?q("",!0):(T(),E(y,{key:0,description:"没有更多了"})),x("div",j(h(v),{style:{height:"100vh"}}),[x("div",J(K(h(g))),[(T(!0),M(X,null,Y(h(d),l=>(T(),M("div",{class:"p-2",key:l.data.nickname},[P(Ge,{onClick:ke=>m.$router.push(`/user/${l.data.user_id}`),class:"rounded-md bg-slate-300 hover:bg-blue-400","card-data":l.data},null,8,["onClick","card-data"])]))),128))],16)],16)]),_:1})]),_:1},8,["active"]),P(W,{show:H.isShow,"onUpdate:show":u[2]||(u[2]=l=>H.isShow=l),title:"立即分享给好友",options:H.shareOptions},null,8,["show","options"]),P(Ce,{class:"h-96",show:G.value,"onUpdate:show":u[6]||(u[6]=l=>G.value=l),title:"评论"},{default:z(()=>[P(ye,{loading:_.value.loading,"onUpdate:loading":u[3]||(u[3]=l=>_.value.loading=l),finished:_.value.finished,"onUpdate:finished":u[4]||(u[4]=l=>_.value.finished=l),error:_.value.error,"onUpdate:error":u[5]||(u[5]=l=>_.value.error=l),"comment-list":F.value,"handle-comment-on-load":h(_e)},null,8,["loading","finished","error","comment-list","handle-comment-on-load"])]),_:1},8,["show"])])}}});export{Ot as default};
