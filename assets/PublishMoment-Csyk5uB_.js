import{d as x,v as F,aA as V,G as D,r as i,A as M,c as P,b as s,w as u,s as v,f as k,o as U,g as B,F as C,i as N}from"./index-Al1ESLyH.js";import{a as E,U as S}from"./index-Ci1VZxiM.js";import{C as q}from"./index-DJB-JNsy.js";import{b as A}from"./index-GFwVjkA3.js";import{k as G,o as R,q as T}from"./index-Bc0MyXRq.js";import{F as z}from"./index-Cb0lWyr4.js";import{B as L}from"./index-dW7UAVpM.js";import"./index-BFdtbEqF.js";import"./function-call-CNCgHTtt.js";import"./index-uvLI7Ok2.js";import"./index-o3mCI9mj.js";const j={class:"container flex flex-col bg-white"},H=x({__name:"PublishMoment",setup(J){F(()=>{var e;(e=m.params)!=null&&e.editId&&g(Number(m.params.editId))});const m=V(),w=k(),c=D(),p=i(),y=M(()=>{var e;return!!((e=m.params)!=null&&e.editId)}),g=async e=>{try{let a=await G(e);p.value=a.data,d.value=p.value.images.map(t=>({url:t.image_url,beforeDelete:()=>(_.value.push(t.image_id),!0)})),r.value=p.value.content}catch(a){console.error(a)}},I=async e=>{await A(e)},r=i(""),_=i([]),d=i([]),h=async()=>{var e,a;try{const t=new FormData;d.value.forEach(o=>{t.append("moment_post",o.file)});const l={filedata:t,flag:"moment_post",username:c.userInfo.username};_.value.length&&await I(_.value);let n=[];n=(await E(l)).data.fileUrls;const f={user_id:(e=c.userInfo)==null?void 0:e.user_id,content:r.value,image_urls:n};if(y.value){const o={user_id:(a=c.userInfo)==null?void 0:a.user_id,content:r.value,image_urls:n,dynamic_post_id:Number(m.params.editId)};await R(o),v("修改成功")}else await T(f),v("发布成功");w.back()}catch(t){console.error(t),v("发布失败，请重试")}};return(e,a)=>{const t=C,l=q,n=S,b=L,f=z;return U(),P("main",j,[s(f,{onSubmit:h},{default:u(()=>[s(l,{class:"p-1 m-2 border border-blue-200 rounded-md"},{default:u(()=>[s(t,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o),rows:"10",spellcheck:!1,autosize:"",type:"textarea",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(l,{class:"p-2 m-2 border border-blue-200 rounded-md"},{default:u(()=>[s(n,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=o=>d.value=o),multiple:"",class:"my-upload flex-nowrap overflow-x-auto max-w-full max-h-80"},null,8,["modelValue"])]),_:1}),s(l,{class:"p-2 m-2"},{default:u(()=>[s(b,{type:"primary",round:"","native-type":"submit",block:""},{default:u(()=>[B("提交")]),_:1})]),_:1})]),_:1})])}}}),oe=N(H,[["__scopeId","data-v-2ded589f"]]);export{oe as default};
